<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/default}">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1 maximum-scale=1 minimum-scale=1" />

<script type="text/javascript">

    // 신규 컨설팅 등록
    Vue.component('newConsultPop', {
        template: '#newConsultPop',
        props: ['open', 'cuslist', 'managerlist', 'cescolist', 'cusfoodtypelist', 'isreadonly', 'ispartreadonly',
        'cusservicetypelist', 'cusunitpricetypelist', 'consultcominfo', 'cusbilltypelist', 'cussaletypelist',
        'salemnglist', 'contmnglist'],
        data() {
            return {
                consultList             : [],   // 컨설팅 의뢰 목록
                consultFileInfo         : [],   // 사업자 정보(파일위치)
                consultProdList         : [],   // 컨설팅 의뢰 제품목록
                consultProdListTop      : [],   // 컨설팅 의뢰 제품목록 상단 노출(의뢰컨설팅 등록 전용)

                estimateFileList        : [],   // 견적서 파일 정보
                attachFileList          : [],   // 첨부파일 목록
                userFileList            : [],   // 유저파일 목록
                attachDelFileList       : [],   // 첨부파일 삭제 목록
                attachFileTypeList      : [],   // 첨부파일 유형

                sum_amt                 : 0,    // 견적서 합계

                isNew                   : true,     // 컨설팅 신규 등록 여부
                isUpt                   : false,    // 컨설팅 수정 여부
                isAddIns                : false,    // 의뢰컨설팅 등록 여부

                mngCescoList            : [],       // 세스코 주 담당자 목록
                mngManagerList          : [],       // 주 담당자 목록
                estList                 : [],
                cntReadonly             : 0,
                bSearchFtype            : [],
                licnt                   : -1,
                popSearchComList        : [],
            }
        },
        filters: {
            currency: function (value) {
                var num = new Number(value);
                return num.toFixed(0).replace(/(\d)(?=(\d{3})+(?:\.\d+)?$)/g, "$1,")
            }
        },
        destroyed(){
            $(document).off('click.pop');
        },
        mounted(){
            let _this = this;
            _this.onReSet();

            if(_this.consultcominfo.fs_status_cd === '02'){
                _this.isUpt = true;
                _this.isNew = false;
            }else if(_this.consultcominfo.fs_status_cd === '01'){
                _this.isAddIns = true;
                _this.isNew = false;
            }            

            if(_this.isreadonly){
                _this.isUpt = true;
                _this.isNew = false;
            }        

            // 신규 등록
            if(_this.isNew){
                // 제품 정보
                let newconsultInfo = {
                        prod_nm         : '',   // 요청시 등록한 유형이름 상품명
                        prod_tp_cd      : '',   // 관리자가 정의한 유형 
                        // prod_tp_nm      : '',   // 관리자가 정의한 유형이름 
                        prod_tp_cust_nm : '',   // 요청시 등록한 유형이름
                        prod_item       : '',   // 품목보고번호
                        prod_ser_cd     : '',   // 정기 비정정기 서비스구분
                        prod_unit_cd    : '',   // 단가구분(의뢰구분)
                        prod_mafa_nm    : '',   // 제조업체명
                        est_amt         : 0,    // 견적단가
                        sale_tp_cd      : ''    // 매출구분
                }
                _this.consultProdList.push(newconsultInfo);
                _this.bSearchFtype.push(false);
                _this.estList.push(0);

                _this.addFileUpload('estimateFileList');
                _this.addFileUpload('attachFileList');
                // _this.setCescoList();
                                
            }else if(_this.isUpt){

                let _this = this;
                // 제품 정보 가져오기 
                _this.onGetProdList(); 

                // 첨부 파일 정보 가져오기 F00001 : 유저입력 F00002 : 견적서 F00003 : 제품유형별 이미지
                let param = [
                    { atch_kn_cd : 'F00001', arr : 'userFileList' },            // 유저 등록 파일
                    { atch_kn_cd : 'F00002', arr : 'estimateFileList' },        // 견적서 파일
                    { atch_kn_cd : 'F00003', arr : 'attachFileList' }           // 유형 이미지 파일
                ];
                
                // 첨부파일 정보 가져오기
                _this.onGetAttachList(param);                
                
                // _this.$emit('set-top-list', _this.consultcominfo.cst_id, 'CF02', "contMngList");
                // _this.$emit('set-top-list', _this.consultcominfo.cst_id, 'CF06', "saleMngList");
                
                // 담당자 정보 가져오기
                _this.onGetManagerList();

            }else if(_this.isAddIns){
                // 의뢰등록

                let _this = this;
                // 제품 정보 가져오기 
                _this.onGetProdList();

                // 첨부 파일 정보 가져오기 F00001 : 유저입력 F00002 : 견적서 F00003 : 제품유형별 이미지
                let param = [
                    { atch_kn_cd : 'F00001', arr : 'userFileList' }        // 유저 등록 파일
                ];
                
                // 첨부파일 정보 가져오기
                _this.onGetAttachList(param);
                _this.addFileUpload('estimateFileList');
                _this.addFileUpload('attachFileList');
                // _this.setCescoList();
                _this.consultcominfo.tax_bill_tp_cd = '02';

                // _this.$emit('set-top-list', _this.consultcominfo.cst_id, 'CF02', "contMngList");
                // _this.$emit('set-top-list', _this.consultcominfo.cst_id, 'CF06', "saleMngList");

                // setCuscomInfo
                let paramdata = {
                    cst_id : _this.consultcominfo.cst_id,
                    cst_nm : _this.consultcominfo.cst_nm
                }

                _this.$emit('on-set-cuscom-info', paramdata);
            }           

            $(document).on('click.pop',function(event) {
                if(event.target.type != 'checkbox' && event.target.type != 'radio'){
                    if('inputPopCom' != event.target.name){
                        $.each(_this.consultProdList, function(index, obj){
                            if(obj.prod_tp_cd == ''){
                                obj.prod_tp_cust_nm = '';
                            }
                            _this.bSearchFtype[index] = false;
                        })
                        _this.bSearchFtype = _this.bSearchFtype.filter((item,index)=> item = false);
                    }
                }
            });
        },
        updated(){
            // 읽기 전용
            let _this = this;
            if(_this.cntReadonly++ < 8){
                if(_this.cntReadonly > 3){
                    if(_this.isreadonly && document.getElementById('consultPopDiv') !=null){
                        for(el of document.getElementById('consultPopDiv').getElementsByTagName('input')){
                            if(!(_this.ispartreadonly && el.type == 'checkbox' && el.name != 'bill_check')){
                                el.disabled = _this.isreadonly;
                            }
                        }
                        for(el of document.getElementById('consultPopDiv').getElementsByTagName('select')){
                            if(!(_this.ispartreadonly && (el.id == 'selManager' || el.id == 'selCescoManager'))){
                                el.disabled = _this.isreadonly;
                            }
                        }
                    }
                }                
            }
        },
        
        methods: {
            // 정보 초기화
            onReSet: function(){
                let _this = this;
                _this.consultList           = [];
                _this.consultFileInfo       = [];
                _this.consultProdList       = [];

                _this.attachFileTypeList    = [];
                _this.sum_amt               = 0;

                _this.isUpt                 = false;
                _this.isAddIns              = false;
            },

            // 창 닫기
            onPopClose : function() {
                this.$emit("on-pop-close","");
            },

            // 세스코 담당자 Grid
            // setCescoList : function(){

            //     let _this = this;

            //     var cescoSource = {
            //         datatype: "json", // json 형태의 데이터를 셋팅할 것이고. // array
            //         datafields: [     // 각 필드의 이름과 타입은 datafields에 마찬가지로 json 형태이다.
            //             { name: 'cst_id',           type: 'string'},        // 고객사ID
            //             { name: 'cst_nm',           type: 'string'},        // 고객사명
            //             { name: 'fs_bill_mng_yn',   type: 'string'},		// 정산담당
            //             { name: 'fs_chat_yn',       type: 'string'},		// 선택
            //             { name: 'bfs_chat_yn',      type: 'bool'},	    	// 선택
            //             { name: 'fs_no',            type: 'string'},        // 컨설팅번호
            //             { name: 'fs_seq',           type: 'string'},        // 순번
            //             { name: 'mdfr_id',          type: 'string'},		// 수정자ID
            //             { name: 'rgstr_id',         type: 'string'},        // 등록자ID
            //             { name: 'status',           type: 'string'},		// 상태
            //             { name: 'user_dept_nm',     type: 'string'},        // 지역본부명
            //             { name: 'user_id',          type: 'string'},        // 담당자ID
            //             { name: 'user_nm',          type: 'string'},	    // 담당자명
            //         ],  
            //         localdata: _this.cescolist, // 위에서 셋팅해놓은 data를 localdata에 담아준다.
            //     };            

            //     var cescoDataAdapter = new $.jqx.dataAdapter(cescoSource);
        
            //     $('#cescoGrid').jqxGrid('clearselection');

            //     $("#cescoGrid").jqxGrid({  
            //         width               :   '100%',
            //         autoheight          :   true,
            //         autorowheight		:   true,
            //         source              :   cescoDataAdapter,
            //         // selectionmode       :   'checkbox',
            //         editable: true,
            //         selectionmode       :   'singlerow',
            //         pageable			:   true,
            //         pagermode			:   'simple',
            //         pagesize			:   5,
            //         pagerbuttonscount	:   5,
            //         columnsheight       :   60,
            //         rowsheight          :   60,
            //         localization        :   {emptydatastring:'해당 자료가 존재하지 않습니다.'},
            //         columns: [
            //             {
            //                 text: 'No', sortable: false, filterable: false, editable: false,
            //                 groupable: false, draggable: false, resizable: false,
            //                 datafield: '', columntype: 'number', align:'center', cellsalign: 'center', 
            //                 cellsrenderer: function (row, column, value) {
            //                     return value;
            //                 },
            //             },                    
            //             {   text : '선택',datafield: 'bfs_chat_yn' , columntype: 'checkbox', cellsalign: 'center', align : 'center', editable: true },
            //             {   text : '부서명',datafield: 'user_dept_nm', cellsalign: 'center', align : 'center', editable: false },
            //             {   text : '담당자',datafield: 'user_nm', cellsalign: 'center', align : 'center', editable: false },
            //             {   text : '아이디',datafield: 'user_id', cellsalign: 'center', align : 'center', editable: false },
            //         ]                 
            //     });

            // },

            // 담당자 정보 가져오기
            onGetManagerList: function(){

                let _this = this;

                let param = { 
                    sys_id : _this.consultcominfo.sys_id ,
                    fs_no : _this.consultcominfo.fs_no
                };

                // 담당자 목록 가져오기
                axiosCall('get', '/consult/api/consultManagerList', param, function(response) {
                    
                    response.data.forEach(manager => {
                        
                        // 세스코 담당자 
                        if(manager.cst_id === '10000000'){
                            _this.cescolist.forEach(cesco => {
                                if(manager.user_id === cesco.user_id){
                                    cesco.fs_chat_yn = manager.fs_chat_yn;
                                    if(cesco.fs_chat_yn === 'Y'){
                                        _this.mngCescoList.push(cesco);
                                        cesco.bfs_chat_yn = true;
                                    }else{
                                        cesco.bfs_chat_yn = false;
                                    }
                                }
                            });
                        }else{
                            // 고객사 담당자
                            _this.managerlist.push(manager);
                            if(manager.fs_chat_yn === 'Y'){
                                _this.mngManagerList.push(manager);
                            }

                            let cusChk = true;
                            _this.cuslist.forEach(cus => {
                                if(cusChk){
                                    if(cus.cst_id === manager.cst_id) cusChk = false;
                                }
                            });

                            if(cusChk){
                                let cusInfo = {
                                    cst_id : manager.cst_id,
                                    cst_nm : manager.cst_nm, 
                                    sys_id : _this.consultcominfo.sys_id
                                }
                                _this.cuslist.push(cusInfo);
                            }
                        }
                    });

                    _this.managerlist.sort(function compare(a, b){
                        return a.user_nm < b.user_nm ? -1 : 1;
                    })

                    let orderList = [];

                    orderList = _this.managerlist.filter((item)=> item.fs_chat_yn == 'Y');

                    $.each(_this.managerlist, function(index, item){
                        if(item.fs_chat_yn != 'Y' && item.fs_bill_mng_yn == 'Y'){
                            orderList.push(item);
                        }
                    })

                    $.each(_this.managerlist, function(index, item){
                        if(item.fs_chat_yn != 'Y' && item.fs_bill_mng_yn != 'Y'){
                            orderList.push(item);
                        }
                    })

                    _this.$emit('set-manager-list', orderList);
                    
                });
            },

            // 파일 다운로드
            onDownload: function(filename){
                axiosCallDownLoad(filename);
            },

            // 첨부파일 가져오기
            onGetAttachList: function(data){

                let _this = this;
                data.forEach(fileList => {
                    let param = { 
                        sys_id : _this.consultcominfo.sys_id,
                        fs_no : _this.consultcominfo.fs_no,
                        atch_kn_cd : fileList.atch_kn_cd
                    };

                    // 첨부파일 정보 가져오기
                    axiosCall('get', '/consult/api/consultAttachList', param, function(response) {
                        response.data.forEach(element => {
                            _this[fileList.arr].push(element);
                        });

                        if(fileList.arr === 'attachFileList'){
                            _this.addFileUpload('attachFileList');
                        }
                        if(fileList.arr === 'estimateFileList' && _this[fileList.arr].length === 0){
                            _this.addFileUpload('estimateFileList');
                        }
                    });
                });
            },

            // 제품 정보 가져오기
            onGetProdList: function(){

                let _this = this;

                let param = { 
                    sys_id : _this.consultcominfo.sys_id ,
                    fs_no : _this.consultcominfo.fs_no
                };

                // 제품 목록 가져오기
                axiosCall('get', '/consult/api/consultProdList', param, function(response) {

                    response.data.forEach(element => {
                        _this.estList.push(element.est_amt1);
                        element.est_amt = element.est_amt1.toLocaleString();
                        if(_this.isAddIns){
                            element.prod_tp_cd = '';
                            _this.consultProdListTop.push(element);
                        }
                        _this.consultProdList.push(element);
                        
                    });
                    _this.getSumAmt();
                    _this.onTpChg();
                });
            },

            // 첨부파일 유형 변경 관리
            onTpChg: function(){
                
                let _this = this;
                let selFoodType = [];
                _this.attachFileTypeList = [];
                
                $.each(_this.consultProdList, function(idx, item){

                    if(item.prod_tp_cd != ''){

                        let bChkType = true;

                        $.each(_this.attachFileTypeList, function(subIdx, subItem){

                            if(item.prod_tp_cd == subItem.prod_tp_cd){
                                bChkType = false;
                                return false;
                            }

                        });

                        if(bChkType){
                            let setItem = {
                                prod_tp_cust_nm : item.prod_tp_cust_nm,
                                prod_tp_cd : item.prod_tp_cd
                            }
                            _this.attachFileTypeList.push(setItem);
                        }
                    }   
                });   
                
                $.each(_this.attachFileList, function(atIdx, item){

                    let bSelFtype = false;

                    $.each(_this.attachFileTypeList, function(atIdxSub, itemSub){
                        if(item.atch_ref_id == itemSub.prod_tp_cd){
                            bSelFtype = true;
                            return false;
                        }
                    });

                    if(!bSelFtype){
                        _this.attachFileList[atIdx].atch_ref_id = '';
                    }
                });
            },

            // 첨부 파일 선택
            onFileUpload: function(e, index, type){
                
                let _this = this;

                if(e.target.files[0] == undefined){
                    _this.attachFileList[index].org_file_nm = '';
                    _this.attachFileList[index].atch_nm = '';
                }else{

                    let fileSize = ((e.target.files[0].size)/1024/1024).toFixed(4);
                    
                    // if(fileSize > 5000){
                    //     cmmAlert('5G이상 등록 할 수 없습니다.');
                    //     return false;
                    // }

                    if(e.target.value != ''){
                        if(type === 'M'){
                            _this.attachFileList[index].org_file_nm = e.target.files[0].name;
                            _this.attachFileList[index].atch_nm = e.target.files[0].name;
                            if(_this.isUpt)
                                _this.attachFileList[index].status = 'N';
                        }else{
                            _this.estimateFileList[index].atch_nm = e.target.files[0].name;
                            _this.estimateFileList[index].org_file_nm = e.target.files[0].name;
                            if(_this.isUpt)
                                _this.estimateFileList[index].status = 'N';
                        }
                    }
                }
            },

            // 첨부파일 추가
            addFileUpload: function(listName){

                let flieType = '';

                switch (listName) {
                    case 'estimateFileList':
                        flieType = 'F00002';
                        break;
                    case 'attachFileList':
                        flieType = 'F00003';
                        break;
                    default:
                        break;
                }

                let _this = this;
                // 첨부파일
                let attachFile = {
                    atch_seq : '0',             // 파일첨부순번
                    atch_kn_cd : flieType,      // 파일종류구분 FS015[첨부구분]
                    atch_ref_id : '',           // 파일 식품유형 코드 FS001[식품유형]
                    atch_nm : '',               // 파일명
                    url : '',                   // 서버주소
                    org_file_nm : '',           // 원본파일명
                    ser_file_nm : '',           // 서버파일명
                    status : 'Y'                // 상태
                }
                _this[listName].push(attachFile);

            },

            // 파일 목록에서 삭제
            delFileUpload: function(delIndex){

                let _this = this;

                if(_this.isUpt && parseInt(_this.attachFileList[delIndex].atch_seq) > 0){
                    _this.attachDelFileList.push(_this.attachFileList[delIndex]);
                }

                _this.attachFileList = _this.attachFileList.filter((item,index)=> index != delIndex)

                if(_this.attachFileList.length == 0){
                    _this.addFileUpload('attachFileList')
                }
                
            },

            // 컨설팅 제품 추가
            addConcult : function() {
                let _this = this;
                let newconsultInfo = {
                    prod_nm         : '',       // 요청시 등록한 유형이름 상품명
                    prod_tp_cd      : '',       // 관리자가 정의한 유형 
                    prod_tp_cust_nm : '',       // 요청시 등록한 유형이름
                    prod_item       : '',       // 품목보고번호
                    prod_ser_cd     : '',       // 정기 비정정기 서비스구분
                    prod_unit_cd    : '',       // 단가구분(의뢰구분)
                    prod_mafa_nm    : '',       // 제조업체명
                    est_amt         : 0,        // 견적단가
                    sale_tp_cd      : ''        // 매출구분
                }
                _this.consultProdList.push(newconsultInfo);
                _this.bSearchFtype.push(false);
            },

            // 컨설팅 제품 삭제
            delConcult : function(delIndex) {
                let _this = this;
                _this.consultProdList = _this.consultProdList.filter((item,index)=> index != delIndex)
                _this.estList = _this.estList.filter((item,index)=> index != delIndex)
                _this.bSearchFtype = _this.bSearchFtype.filter((item,index)=> index != delIndex)
                _this.getSumAmt();                
            },

            chkMaxNum: function(e, idx, maxNum){

                let inNum = e.target.value.replace(/[^0-9]/g, '');
                inNum = inNum == '' ? 0 : inNum;
                inNum = inNum < 1 ? 0 : inNum;

                let _this = this;                
                _this.consultProdList[idx].est_amt = parseInt(inNum).toLocaleString() > parseInt(maxNum).toLocaleString() ? parseInt(maxNum).toLocaleString() : parseInt(inNum).toLocaleString();
                _this.estList[idx] = parseInt(inNum) > parseInt(maxNum) ? parseInt(maxNum) : parseInt(inNum);
                _this.getSumAmt();
            },

            // 견적서 합계
            getSumAmt : function(){
                
                let _this = this;
                let sum = 0;

                _this.estList.forEach((est) => {
                    sum += parseInt(est); 
                });

                _this.sum_amt = sum;
            },

            // 협렵사 담당자 팝업
            onManagerSearchPopOpen : function(type){
                if(this.cuslist.length == 0 && type != 'C'){
                    cmmAlert("고객사를 먼저 등록해 주세요.")
                    return false;
                }
                this.$emit("on-manager-pop-open", type);
            },

            // 계약사 조회 팝업
            onContSearchPopOpen : function(type){
                this.$emit("on-cont-pop-open", type);
            },            

            // 현재 구성 즐겨찾기 등록 팝업
            onCusFavoritesAddPopOpen : function(){

                let _this = this;
                
                if(_this.cuslist.length === 0){
                    cmmAlert('협력사 목록이 없습니다.');
                    return false
                }

                if(_this.consultcominfo.cst_id === ''){
                    cmmAlert('컨설팅 고객사가 선택 되지 않았습니다.');
                    return false;
                }
                
                _this.$emit("on-favorites-pop-open");
            },

            // 현재 구성 즐겨찾기 목록 팝업
            onCusFavoritesListPopOpen : function(){
                this.$emit("on-favorites-list-pop-open");
            },
            
            // 협력사 삭제
            setCusDel : function(cst_id){
                let _this = this;
                
                for(chkManager of _this.managerlist){
                    if(chkManager.fs_bill_mng_yn == 'Y' && chkManager.cst_id == cst_id){
                        cmmAlert('정산 담당자가 포함된 협력사는 삭제 할 수 없습니다.');
                        return false;
                    }
                }

                _this.$emit("set-cus-del",cst_id);
                _this.mngManagerList = _this.mngManagerList.filter((item,index)=> item.cst_id != cst_id)
                _this.consultcominfo.cusMainManager = '';
            },

            // 담당자만 수정
            setConSultManager: function(){
                
                let _this = this;
                
                let cntManagerlist = _this.managerlist.length;
                
                if(cntManagerlist === 0){
                    cmmAlert('담당자 목록이 없습니다.');
                    return false;
                }

                let cntChatMem = 0;
                let cntBillMem = 0;

                for (let i = 0; i < cntManagerlist; i++) {
                    if(_this.managerlist[i].fs_bill_mng_yn === "Y") cntBillMem++;
                    if(_this.managerlist[i].fs_chat_yn === "Y") cntChatMem++;
                }

                if(cntChatMem === 0){
                    cmmAlert('선택된 담당자가 없습니다.');
                    return false;
                }                

                if(cntBillMem === 0 && _this.consultcominfo.tax_bill_tp_cd == '01'){
                    cmmAlert('선택된 정산 담당자가 없습니다.');
                    return false;
                }

                let cntCescolist = _this.cescolist.length;
                let cntCescoChat = 0;

                for (let i = 0; i < cntCescolist; i++) {
                    if(_this.cescolist[i].fs_chat_yn === "Y") cntCescoChat++;
                }

                if(cntCescoChat === 0){
                    cmmAlert('선택된 세스코 담당자가 없습니다.');
                    return;
                }

                if(_this.consultcominfo.cusMainManager === ''){
                    cmmAlert('고객 주 담당자를 선택해 주세요.');
                    return false;
                }

                if(_this.consultcominfo.cescoMainManager === ''){
                    cmmAlert('세스코 주 담당자를 선택해 주세요.');
                    return false;
                }

                let reqManagerList = [];

                _this.managerlist.forEach(manager => {
                    reqManagerList.push(manager);
                });

                _this.cescolist.forEach(cesco => {
                    if(cesco.fs_chat_yn === 'Y'){
                        reqManagerList.push(cesco);
                    }
                });

                $.each(reqManagerList, function(idx, item){
                    item.fs_no = _this.consultcominfo.fs_no;
                })  
                
                const formData = new FormData();
                formData.append("consultInfo", new Blob([JSON.stringify(_this.consultcominfo)], {type: "application/json"}));
                formData.append("reqManagerList", new Blob([JSON.stringify(reqManagerList)], {type: "application/json"}));

                axiosCall('multi', '/consult/api/uptManager', formData, function(response) {

                    cmmAlert(response.data);
                    _this.$emit("on-pop-close","");
                    _this.$emit("on-reload","");

                });

            },

            // 등록
            setConSult : function(){
                let _this = this;
                let valueChk = true;

                if(_this.isreadonly){
                    cmmAlert('수정이 불가능 합니다.');
                    return false;
                }                

                if(_this.consultcominfo.cst_nm == '' ||_this.consultcominfo.cst_nm == null ){
                    cmmAlert('고객사를 선택해 주세요.');
                    return false;
                }

                if(_this.consultcominfo.sale_mng_id == ''){
                    cmmAlert('매출사원을 선택해 주세요.');
                    return false;
                }

                if(_this.consultcominfo.cont_id == ''){
                    cmmAlert('계약사원을 선택해 주세요.');
                    return false;
                }                

                // 등록 제품 정보 확인
                _this.consultProdList.forEach((consult) => {
                    
                    if(valueChk){
                        if(consult.prod_nm === ''){
                            cmmAlert('제품명을 입력해 주세요.');
                            valueChk = false;
                            return false;
                        }      

                        if(consult.sale_tp_cd === ''){
                            cmmAlert('매출 구분을 선택해 주세요.');
                            valueChk = false;
                            return false;
                        }

                        if(consult.prod_tp_cd === ''){
                            cmmAlert('식품 유형을 선택해 주세요.');
                            valueChk = false;
                            return false;
                        }

                        if(consult.prod_ser_cd === ''){
                            cmmAlert('서비스구분을 선택해 주세요.');
                            valueChk = false;
                            return false;
                        }

                        if(consult.prod_mafa_nm === ''){
                            cmmAlert('제조업체명을 선택해 주세요.');
                            valueChk = false;
                            return false;
                        }
                    }
                });

                if(!valueChk) return false;

                let cntManagerlist = _this.managerlist.length;
                
                if(cntManagerlist === 0){
                    cmmAlert('담당자 목록이 없습니다.');
                    return false;
                }

                let cntChatMem = 0;
                let cntBillMem = 0;

                for (let i = 0; i < cntManagerlist; i++) {
                    if(_this.managerlist[i].fs_bill_mng_yn === "Y") cntBillMem++;
                    if(_this.managerlist[i].fs_chat_yn === "Y") cntChatMem++;
                }

                if(cntChatMem === 0){
                    cmmAlert('선택된 담당자가 없습니다.');
                    return false;
                }

                if(cntBillMem === 0 && _this.consultcominfo.tax_bill_tp_cd == '01'){
                    cmmAlert('선택된 정산 담당자가 없습니다.');
                    return false;
                }

                let cntCescolist = _this.cescolist.length;
                let cntCescoChat = 0;

                for (let i = 0; i < cntCescolist; i++) {
                    if(_this.cescolist[i].fs_chat_yn === "Y") cntCescoChat++;
                }

                if(cntCescoChat === 0){
                    cmmAlert('선택된 세스코 담당자가 없습니다.');
                    return false;
                }

                if(_this.consultcominfo.cusMainManager === ''){
                    cmmAlert('고객 주 담당자를 선택해 주세요.');
                    return false;
                }

                if(_this.consultcominfo.cescoMainManager === ''){
                    cmmAlert('세스코 주 담당자를 선택해 주세요.');
                    return false;
                }

                if(_this.consultcominfo.tax_bill_tp_cd === ''){
                    cmmAlert('계산서 선발행 여부를 선택해 주세요.');
                    return false;
                }


                if(!valueChk) return false;

                let reqManagerList = [];

                _this.managerlist.forEach(manager => {
                    reqManagerList.push(manager);
                });

                _this.cescolist.forEach(cesco => {
                    if(cesco.fs_chat_yn === 'Y'){
                        reqManagerList.push(cesco);
                    }
                });

                let selAttachFileList = [];

                //첨부 파일 유형 선택 확인
                _this.attachFileList.forEach(file => {
                    if(valueChk){
                        if(file.org_file_nm.length > 0){
                            if(file.atch_ref_id === '' ){
                                cmmAlert('첨부한 파일 중에 유형이 선택되지 않은 파일이 있습니다.');
                                valueChk = false;
                            }else if(file.atch_nm.trim() === ''){
                                cmmAlert('첨부한 파일 중에 파일명이 입력되지 않은 파일이 있습니다.');
                                valueChk = false;
                            }else{
                                selAttachFileList.push(file);
                            }
                        }
                    }
                });

                if(!valueChk) return false;

                let selEstimateFileList = [];

                _this.estimateFileList.forEach(file => {
                    if(file.org_file_nm !== ''){
                        selEstimateFileList.push(file);
                    }
                });

                let regType = "S";

                if(_this.isAddIns) regType = "C";

                _this.consultProdList.forEach((consult, idx) => {
                    consult.est_amt = _this.estList[idx];
                });                

                let data = { 
                    'reg_type' : regType,
                    'sys_id' : 'FS',
                    'consultCusInfo' : _this.consultcominfo,
                    'listConsultManager' : reqManagerList,
                    'listConsultProdInfo' : _this.consultProdList,
                    'listConsultAttach' : selAttachFileList,
                    'listConsultEstAttach' : selEstimateFileList,
                    'listConsultAttachDel' : _this.attachDelFileList
                }

                var files = document.getElementsByName("est_file");
                var attachfiles = document.getElementsByName("attach_file_list");

                const formData = new FormData();
                formData.append("consinfo", new Blob([JSON.stringify(data)], {type: "application/json"}));

                for (let i = 0; i < files.length; i++) {
                    formData.append('estfiles', files[i].files[0]);
                }

                for (let i = 0; i < attachfiles.length; i++) {
                    formData.append('attachfiles', attachfiles[i].files[0]);
                }

                let axiosUrl = "/consult/api/";

                if(_this.isUpt){
                    axiosUrl = "/consult/api/uptConsultReg";
                }else if(_this.isNew){
                    axiosUrl = "/consult/api/newConsultReg";
                }else if(_this.isAddIns){
                    axiosUrl = "/consult/api/newConsultReg";
                }else{
                    return false;
                }

                showLoader();

                let headers = {
                    "Content-Type": "multipart/form-data",
			        'x-requested-with' : 'AJAX'
                };

                // axios로 api 호출
                axios({
                    method: 'post',
                    url: axiosUrl,
                    headers: headers,
                    data: formData,
                }).then(function(response){
                    cmmAlert(response.data);
                }).catch(function(error){
                    if(error){
                        if(error.response.data.message === 'ERR_AJAX'){
                            location.href = "/user/login";
                            return;
                        }else{
                            cmmAlert(error.response.data.message);
                        }			
                    }
                }).finally(function(){
                    _this.$emit("on-pop-close","");
                    _this.$emit("on-reload","");

                    closeLoader();
                })
                
            },

            // 세스코 주 담당자 목록
            onChkCesco: function(){
                let _this = this;
                let chkMngCesco = false;

                _this.mngCescoList = [];
                _this.cescolist.forEach(cesco => {
                    if(cesco.fs_chat_yn === 'Y'){
                        _this.mngCescoList.push(cesco);
                        if(cesco.user_id === _this.consultcominfo.cescoMainManager) chkMngCesco = true;
                    }
                });

                if(!chkMngCesco) _this.consultcominfo.cescoMainManager = '';
                
            },

            // 주 담당자 목록
            onChkManager: function(){

                let _this = this;
                let chkMngManager = false;

                _this.mngManagerList = [];
                _this.managerlist.forEach(manager => {
                    if(manager.fs_chat_yn === 'Y'){
                        _this.mngManagerList.push(manager);

                        if(manager.user_id === _this.consultcominfo.cusMainManager) chkMngManager = true;
                    }
                });
                
                if(!chkMngManager) _this.consultcominfo.cusMainManager = '';

            },

            // 주 담당자 목록(정산 담당자 관련)
            onChkBillManager: function(idx){
                let _this = this;                
                _this.managerlist.forEach((manager, index) => {
                    manager.fs_bill_mng_yn = 'N';
                    if(index === idx) manager.fs_bill_mng_yn = 'Y';
                });

                _this.onChkManager();
            },

            // 주 담당자 이름 설정
            selCusMainManager: function(e, iType){
                let val = e.target.value == '' ? '' : e.target.options[e.target.selectedIndex].text;
                
                if(iType == 1){
                    this.$emit("set-main-manager-nm",val);
                }else{
                    this.$emit("set-main-cesco-nm",val);
                }
            },

            setAmtPrice:function(idx){
                let _this = this;                
                $.each(_this.cusunitpricetypelist, function(i, obj){
                    if(obj.cmm_dtl_cd == _this.consultProdList[idx].prod_unit_cd){
                        _this.consultProdList[idx].est_amt = obj.etc_cd1_amt;
                        _this.consultProdList[idx].est_amt = obj.etc_cd1_amt.toLocaleString();
                        _this.estList[idx] = parseInt(obj.etc_cd1_amt);
                        _this.getSumAmt();
                        return false;
                    }
                });
            },

            setTaxBillCd:function(code){
                if(code == '02'){
                    $.each(this.managerlist, function(idx, obj){
                        obj.fs_bill_mng_yn = 'N';
                    })
                }
            },

            closeSearchDiv: function(idx){
                let _this = this;
                $.each(_this.bSearchFtype, function(index, obj){

                    if(index == idx){
                        _this.bSearchFtype[index] = true;
                    }else{
                        _this.bSearchFtype[index] = false;
                    }
                })
            },

            onRegSelClick: function(idx){
                let _this = this; 
                _this.getSearchComList(_this.consultProdList[idx].prod_tp_cust_nm, idx);
            },

            getSearchComList: function(val, idx){
                let _this = this;

                _this.licnt = -1;
                _this.closeSearchDiv(idx);
                _this.popSearchComList = _this.cusfoodtypelist.filter((item,index)=> item.cmm_dtl_nm.indexOf(val) > -1);
                _this.bSearchFtype[idx] = true;
                _this.onTpChg();
                _this.$forceUpdate();
            },

            onDeptKeyUp: function(e, idx){
                let _this = this;

                _this.consultProdList[idx].prod_tp_cd = '';
                _this.getSearchComList(e.target.value, idx);
            },

            selComInfo: function(code, name, idx){
                let _this = this;

                _this.consultProdList[idx].prod_tp_cd = code;
                _this.consultProdList[idx].prod_tp_cust_nm = name;
                _this.bSearchFtype[idx] = false;
                _this.onTpChg();
                _this.$forceUpdate();
            },

            onSelKeyUp: function(e, divId, ulId, index){
                let _this = this;
                if(e.keyCode == 13){
                    _this.bSearchFtype[index] = false;
                    _this.$forceUpdate();
                    return false;
                }                

                if(e.keyCode == 38 || e.keyCode == 40){
                    _this.licnt = e.keyCode == 40 ? _this.licnt + 1 : _this.licnt - 1;
                    _this.licnt = _this.licnt == $('#' + ulId + ' li').length ? $('#' + ulId + ' li').length - 1 : _this.licnt;
                    _this.licnt = _this.licnt < 0 ? _this.licnt = 0 : _this.licnt;

                    let scrollH = parseInt($('#' + divId).prop('scrollHeight'));
                    $('#' + divId).scrollTop(_this.licnt * (scrollH / $('#' + ulId + ' li').length) - 20);
                    
                    $.each($('#' + ulId + ' li'), function(idx, obj){
                        if(idx == _this.licnt){
                            // $(obj).css("background-color","#f1f1f1");
                            $(obj).css("background-color","#1E90FF");
                            $(obj).css("color","#FFFFFF");
                            $(obj).css("cursor","pointer");
                            _this.consultProdList[index].prod_tp_cd = String(obj.dataset.tpcd);
                            _this.consultProdList[index].prod_tp_cust_nm = String(obj.innerText);
                            _this.$forceUpdate();
                        }else{
                            $(obj).css("background-color","");
                            $(obj).css("color","");
                            $(obj).css("cursor","");
                        }
                    });
                }
                _this.onTpChg();
            }
        }
    })
    
    // 담당자 선택 팝업
    Vue.component('managerSearchPop', {
        template: '#managerSearchPop',
        props: ['open', 'opentype'],
        data() {
            return {                  
                srchCstNm       : '',        // 검색 고객사명
                custList        : []
            }
        },
        mounted(){
            let _this = this;

            _this.srchCstNm       = '';
            _this.custList        = [];

            _this.searchManager();

        },
        methods: {
            // 창 닫기
            onPopClose : function() {
                this.$emit("on-pop-close","");
            },

            searchManager : function(){
                
                let url = '/commPopup/getCustomerListForPop';
                let _this = this;
                let param = {srchCstNm:(_this.srchCstNm == null || _this.srchCstNm == undefined ? '' : _this.srchCstNm)};

                axiosCall('get', url, param, function(response) {
                    _this.customerList = response.data;
                    _this.drawTable();
                });

            },

            setManager : function() {
               
                let _this = this;

                // 선택 데이터
                let idxs = $('#customerGrid').jqxGrid('getselectedrowindexes');
                if(idxs.length < 1){
                    cmmAlert('협력사를 선택해 주세요.');
                    return false;
                }                

                let rowdata = $('#customerGrid').jqxGrid('getrowdata', idxs);
                if(_this.opentype === 'M'){
                    _this.$emit("on-set-manager-info",rowdata);
                }else{
                    _this.$emit("on-set-cuscom-info",rowdata);
                }
                _this.onPopClose();
            },

            drawTable: function() {

                let _this = this;
                let source = {  
                    datatype: "json", // json 형태의 데이터를 셋팅할 것이고. // array
                    datafields: [     // 각필의 이름과 타입은 datafields에 마찬가지로 json 형태이다.
                        { name: 'sys_id', type: 'string' },     // sys id
                        { name: 'cst_nm', type: 'string' },     // 고객사명
                        { name: 'cst_id', type: 'string' },     // 고객사 코드
                        { name: 'mdfr_dt', type: 'string' },    // 수정일시(등록일시)
                    ],  
                    localdata: _this.customerList, // 위에서 셋팅해놓은 data를 localdata에 담아준다.
                };
                
                var dataAdapter = new $.jqx.dataAdapter(source);  

                $("#customerGrid").jqxGrid({  
                    width               :   '100%',
                    autoheight          :   true,
                    source              :   dataAdapter,
                    selectionmode       :   'singlerow',
                    pageable			:   true,
                    pagermode			:   'simple',
                    pagesize			:   5,
                    pagerbuttonscount	:   5,
                    columnsheight       :   50,
                    rowsheight          :   50,
                    localization        : { emptydatastring:'해당 자료가 존재하지 않습니다.' },
                    columns: [                  // 각 컬럼값들의 대한 설정이다.
                        {
                            text: 'No', sortable: false, filterable: false, editable: false,
                            groupable: false, draggable: false, resizable: false,
                            datafield: '', columntype: 'number', align:'center', width:'10%',
                            cellsrenderer: function (row, column, value) {
                                return "<div style='text-align: center; margin-top: 18px;'>" + (value + 1) + "</div>";
                            }
                        },
                        { text: '고객사명', datafield: 'cst_nm', align:'left', cellsalign:'left', width:'50%' },  
                        { text: '고객사코드', datafield: 'cst_id', align:'center', cellsalign:'center', width:'20%' },  
                        { text: '등록일시', datafield: 'mdfr_dt', align:'center', cellsalign:'center', width:'20%' },
                    ]  
                });
            }
        }
    })

    // 계약자 선택 팝업
    Vue.component('contSearchPop', {
        template: '#contSearchPop',
        props: ['open', 'opentype'],
        data() {
            return {
                searchNm        : '',        // 검색 계약자명
                contList        : []
            }
        },

        mounted(){
            this.drawTable();
            // console.log('this.typesailcont : ' + this.typesailcont);
        },
        
        methods: {
            // 창 닫기
            onPopClose : function() {
                this.$emit("on-pop-close","");
            },
            
            setCont: function(){

                let _this = this;

                // 선택 데이터
                let idxs = $('#contGrid').jqxGrid('getselectedrowindexes');
                                
                if(idxs === undefined){
                    cmmAlert('계약자를 선택해 주세요.');
                    return false;
                }

                let rowdata = $('#contGrid').jqxGrid('getrowdata', idxs);
                
                _this.$emit("on-set-cont-info",rowdata);
                _this.onPopClose();
            },

            drawTable: function() {

                let url = '/consult/api/contList';
                let _this = this;                

                axiosCall('get', url, {user_nm : _this.searchNm}, function(response) {

                    let source = {  
                        datatype: "json", // json 형태의 데이터를 셋팅할 것이고. // array
                        datafields: [     // 각필의 이름과 타입은 datafields에 마찬가지로 json 형태이다.
                            { name: 'staff_id', type: 'string' },           // 계약사사번
                            { name: 'staff_nm', type: 'string' },           // 계약자명
                            { name: 'staff_dept_nm', type: 'string' },      // 부서
                            { name: 'gw_email', type: 'string' },           // 이메일
                        ],  
                        localdata: response.data, // 위에서 셋팅해놓은 data를 localdata에 담아준다.
                    };
                    
                    var dataAdapter = new $.jqx.dataAdapter(source);  

                    $("#contGrid").jqxGrid({  
                        width: '100%',
                        autoheight          :   true,
                        source: dataAdapter,        //위에서 만든 dataAdapter
                        selectionmode: 'singlerow',
                        pageable			:	true,
                        pagermode			:	'simple',
                        pagesize			:	5,
                        pagerbuttonscount	:	5,
                        columnsheight       :   50,
                        rowsheight          :   50,
                        localization        : { emptydatastring:'해당 자료가 존재하지 않습니다.' },
                        columns: [                  // 각 컬럼값들의 대한 설정이다.
                            {
                                text: 'No', sortable: false, filterable: false, editable: false,
                                groupable: false, draggable: false, resizable: false,
                                datafield: '', columntype: 'number', align:'center', width:'10%', 
                                cellsrenderer: function (row, column, value) {
                                    return "<div style='text-align: center; margin-top: 18px;'>" + (value + 1) + "</div>";
                                }
                            },
                            { text: '사번', datafield: 'staff_id', align:'center', cellsalign:'center', width:'20%' },
                            { text: '이름', datafield: 'staff_nm', align:'center', cellsalign:'center', width:'30%' },
                            { text: '부서', datafield: 'staff_dept_nm', align:'center', cellsalign:'center', width:'40%' },
                        ]  
                    });
                });
            }
        }
    })

    // 담당자 팝업
    Vue.component('cstMngPop', {
        template: '#cstMngPop',
        props: ['mngPop','consultingmng'], 
        methods: {
            cloasePop:function() {
                let _this = this;
                _this.$emit("close-mng-pop");
            },
        },
    });

</script>

<script type="text/javascript">
var vue
$(document).ready(function(){
	vue = new Vue({
		el: '#app',
		data: {
            userTpCd                : '[[${session.userTpCd}]]',
            openNewConsultPop       : false,    // 신규등록 팝업
            openRequestPop          : false,    // 의뢰등록 팝업
            openManagerSearchPop    : false,    // 협렵사 담당자 선택 팝업
            openContSearchPop       : false,    // 계약 담당자 선택 팝업
            openCusFavoritesAddPop  : false,    // 협력사 즐겨찾기 등록 팝업
            openCusFavoritesListPop : false,    // 협력사 즐겨찾기 목록 팝업
            mngPop                  : false,    // 담당자 팝업  
            
            consultingMng           : {},       // 담당자 정보조회
            consultSelInfo          : [],       // 선택된 컨설팅 정보

            // 컨설팅 등록 정보
            cusList                 : [],   // 협력사 목록
            managerList             : [],   // 담당자 목록
            cescoList               : [],   // 세스코 담당자 목록

            // 공통코드
            cusFoodTypeList         : [],   // 식품유형             FS001
            cusServiceTypeList      : [],   // 서비스구분           FS005
            cusUnitpriceTypeList    : [],   // 단가구분             FS002
            cusBillTypeList         : [],   // 세금계산서발행구분    FS006 
            cusSaleTypeList         : [],   // 매출 구분            FS028

            // 신규/의뢰 조회 콤보
            comboCescoList          : [],   // 세스코담당자

            // 조회 정보
            consultSearch   :{
                p_type                  : '2',      // 검색 타입 1
                sys_id                  : 'FS',     // 스템 코드 FS
                customer                : '',       // 고객사ID 10000001
                workplace               : '',       //
                food_type               : '',       // 식품유형 FS001
                food_type_nm            : '',
                product_name            : '',       // 제품명
                manager                 : '',       // 담당자 ID
                cesco_person_in_charge  : '',       // 세스코 담당자	
                start_date              : '',       // 접수일 시작 '20221101'
                end_date                : '',       // 접수일 끝 '20221101'
                sale_tp_cd              : '',       // 매출구분
                bill_ar_cd              : '',       // 대금수금구분
                fs_status_cd            : ''        // 상태 코드 FS004
            },            

            // 컨설팅 업체 정보
            consultComInfo          : {
                sys_id              : 'FS', // 시스템 ID FS : 표시컨설팅
                fs_no               : '',   //컨설팅 번호
                fs_status_cd        : '00', // 컨성팅 진행 상태 코드
                cst_id              : '',   //업체 코드
                cst_nm              : '',   //업체 명
                cusMainManager      : '',   // 협력사 주 담당자 정보 : cst_mng_id
                cusMainManager_nm   : '',   // 협력사 주 담당자 명
                cst_mng_nm          : '',   // 고객담당자명
                cescoMainManager    : '',   // 세스코 주 담당자 정보 : fs_bill_no
                cescoMainManager_nm : '',   // 세스코 주 담당자 명
                tax_bill_email      : '',   // 정산 담당자 이메일
                tax_bill_id         : '',   // 정산 담당자 ID
                tax_bill_nm         : '',   // 정산 담당자 명
                cst_cesco_mng_nm    : '',   // 세스코 담당자 명
                tax_bill_tp_cd      : '02', // 계산서 선발행 여부
                cont_id             : '',   // 계약자 ID(사번)
                cont_nm             : '',   // 계약자 이름
                sale_tp_cd          : '',   // 매출 구분
                sale_mng_id         : '',    // 매출사원 ID
                sale_mng_nm         : ''    // 매출사원 명
            },

            gridMaxCnt              : 3,            // 그리드 기본 줄
            isReadonly              : false,        // 수정 불가
            isPartReadonly          : false,        // 부분 수정 가능

            searchComboCus          : [],   //조회 고객사
            searchComboStep         : [],   //조회 진행 단계
            searchComboFType        : [],   //조회 식품 유형
            searchComboCes          : [],   //조회 세스코 담당자
            searchComboManager      : [],   //조회 담당자
            searchDateType          : '',   //날짜 버튼 타입
            searchComboSailType     : [],   //매출 구분
            searchComboBillType     : [],   //대금 수금 구분
            bSearchCombo            : false,

            managerPopType  : 'M',          // 담당자 조회 팝업 타입 M : 담당자 정보 가져오기, C : 고객사 정보만 가져오기
            cusPtype        : '06',           // 고객사 p_type(기본값 관리자 : 06)
            cescoPtype      : '04',           // 세스코 p_type(기본값 관리자 : 04)
            managerPtype    : '05',           // 담당자 p_type(기본값 관리자 : 05)

            bSearchFtypeSh          : false,
            topSearchComList        : [],
            liCnt                   : -1,

            saleMngList         : [],       // 매출사원 목록
            contMngList         : [],       // 계약사원 목록

            typeSailCont        : '',       // 매출,계약 구분
		},
        mounted(){
            let _this = this;
            $("#time05").click();

            if(_this.userTpCd === '02'){
                _this.consultSearch.p_type    = '1';
            }

            if(_this.userTpCd === '01'){
                _this.consultSearch.p_type    = '0';
            }

            // // 공통 코드 가져오기
            // let param = [
            //     {cmm_cd:'FS004', arr_nm:'searchComboStep', comboType:'all',cmm_type:'02'},      //조회 진행 단계
            //     {cmm_cd:'FS001', arr_nm:'searchComboFType'},                   //조회 식품 유형
                                
            //     {sys_cd:'FS',   cmm_cd:'FS005', arr_nm:'cusServiceTypeList', comboType:'select'},               // 서비스구분 목록
            //     {sys_cd:'FS',   cmm_cd:'FS002', arr_nm:'cusUnitpriceTypeList', comboType:'select'},             // 단가구분 목록
            //     {sys_cd:'FS',   cmm_cd:'FS006', arr_nm:'cusBillTypeList'},                                      // 세금계산서발행구분 목록
            //     {sys_cd:'FS',   cmm_cd:'FS001', arr_nm:'cusFoodTypeList'},                  // 식품유형 목록 FS001
            //     {sys_cd:'FS',   cmm_cd:'FS028', arr_nm:'cusSaleTypeList', comboType:'select'},                  // 매출구분 목록 FS028
            //     {sys_cd:'FS',   cmm_cd:'FS028', arr_nm:'searchComboSailType', comboType:'all'},                  // 매출구분 FS028
            //     {sys_cd:'FS',   cmm_cd:'FS007', arr_nm:'searchComboBillType', comboType:'all'},                  // 대금수금구분 FS028
            // ];

            // getCodeListForArrNm(param, _this);

            _this.getCescoManagerList();
            _this.drawGrid();

            $(document).click(function(event) {
                if('inputTopCom' != event.target.name){
                    _this.bSearchFtypeSh = false;      
                    if(_this.consultSearch.food_type == ''){
                        _this.consultSearch.food_type_nm = '';
                    }
                }
            });
        },
		methods: {
            setMainManagerNm: function(val){
                this.consultComInfo.cusMainManager_nm = val;
            },
            setMainCescoNm: function(val){
                this.consultComInfo.cescoMainManager_nm = val;
            },

            // 기본 정보 초기화
            onDefaultReset: function(){
                let _this = this;

                _this.cusList                 = [],   // 협력사 목록
                _this.managerList             = [],   // 담당자 목록
                _this.cescoList.forEach(cesco => {
                    cesco.fs_chat_yn = 'N';
                });
            },

            // 신규 컨설팅 등록
            openNewConsulRegPop : function(){
                let _this = this;
                _this.isReadonly = false;
                _this.isPartReadonly = false;
                _this.openNewConsultPop = true;
                _this.saleMngList = [];       // 매출사원 목록
                _this.contMngList = [];       // 계약사원 목록

                _this.consultComInfo.sys_id              = 'FS';    // 시스템 ID FS : 표시컨설팅
                _this.consultComInfo.fs_no               = '';      //컨설팅 번호
                _this.consultComInfo.fs_status_cd        = '00';    // 컨성팅 진행 상태 코드
                _this.consultComInfo.cst_id              = '';      //업체 코드
                _this.consultComInfo.cst_nm              = '';      //업체 명
                _this.consultComInfo.cusMainManager      = '';      // 협력사 주 담당자 정보 : cst_mng_id
                _this.consultComInfo.cst_mng_nm          = '';      // 고객담당자명
                _this.consultComInfo.cescoMainManager    = '';      // 세스코 주 담당자 정보 : fs_bill_no
                _this.consultComInfo.tax_bill_email      = '';      // 정산 담당자 이메일
                _this.consultComInfo.tax_bill_id         = '';      // 정산 담당자 ID
                _this.consultComInfo.tax_bill_nm         = '';      // 정산 담당자 명
                _this.consultComInfo.cst_cesco_mng_nm    = '';      // 세스코 담당자 명
                _this.consultComInfo.tax_bill_tp_cd      = '02';      // 계산서 선발행 여부
                _this.consultComInfo.cont_id             = '';      // 계약사원 ID
                _this.consultComInfo.cont_nm             = '';      // 계약사원 이름
                _this.consultComInfo.sale_tp_cd          = '';      // 매출구분
                _this.consultComInfo.sale_mng_id         = '';     // 매출사원
                _this.consultComInfo.sale_mng_nm         = '';     // 매출사원명

                _this.onDefaultReset();
            },

            // 신규 컨설팅 등록 닫기
            closeNewConsulRegPop : function(){
                this.openNewConsultPop = false;
            },

            getConsultInfo: function(){

                let _this = this;
                let chkCnt = 0;

                var rowDatas = $("#jqxGrid").jqxGrid('getrows');
                $.each(rowDatas, function(i, obj) {
                    if(obj.check == true){
                        chkCnt++;
                        _this.consultSelInfo = obj;
                    }

                    if(chkCnt > 1){
                        return false;
                    }
                })

                if(chkCnt > 1){
                    cmmAlert('컨설팅 선택은 하나만 가능 합니다.');
                    return false;
                }

                if(chkCnt < 1){
                    cmmAlert('컨설팅을 선택해 주세요.');
                    return false;
                }

                // let idxs = $('#jqxGrid').jqxGrid('getselectedrowindexes');
                // if(idxs.length > 1){
                //     cmmAlert('컨설팅 선택은 하나만 가능 합니다.');
                //     return false;
                // }

                // if(idxs.length < 1){
                //     cmmAlert('컨설팅을 선택해 주세요.');
                //     return false;
                // }

                // _this.consultSelInfo = $('#jqxGrid').jqxGrid('getrowdata', idxs);

                _this.consultComInfo.sys_id              = _this.consultSelInfo.sys_id;             // 시스템 ID FS : 표시컨설팅
                _this.consultComInfo.fs_no               = _this.consultSelInfo.fs_no;              //컨설팅 번호
                _this.consultComInfo.fs_status_cd        = _this.consultSelInfo.fs_status_cd;       // 컨성팅 진행 상태 코드
                _this.consultComInfo.cst_id              = _this.consultSelInfo.cst_id;             //업체 코드
                _this.consultComInfo.cst_nm              = _this.consultSelInfo.cst_nm;             //업체 명
                _this.consultComInfo.cusMainManager      = _this.consultSelInfo.cst_mng_id;         // 협력사 주 담당자 정보 : cst_mng_id
                _this.consultComInfo.cst_mng_nm          = _this.consultSelInfo.cst_mng_nm;         // 고객담당자명
                _this.consultComInfo.cescoMainManager    = _this.consultSelInfo.fs_mng_id;          // 세스코 주 담당자 정보 : fs_bill_no
                _this.consultComInfo.tax_bill_email      = _this.consultSelInfo.tax_bill_email;     // 정산 담당자 이메일
                _this.consultComInfo.tax_bill_id         = _this.consultSelInfo.tax_bill_id;        // 정산 담당자 ID
                _this.consultComInfo.tax_bill_nm         = _this.consultSelInfo.tax_bill_nm;        // 정산 담당자 명
                _this.consultComInfo.cst_cesco_mng_nm    = _this.consultSelInfo.cst_cesco_mng_nm;   // 세스코 담당자 명
                _this.consultComInfo.tax_bill_tp_cd      = _this.consultSelInfo.tax_bill_tp_cd;     // 계산서 선발행 여부
                _this.consultComInfo.cont_id             = _this.consultSelInfo.cont_id;            // 계약사원 ID
                _this.consultComInfo.cont_nm             = _this.consultSelInfo.cont_nm;            // 계약사원 이름
                _this.consultComInfo.cusMainManager      = _this.consultSelInfo.cst_mng_id;         // 협력사 주 담당자 정보 : cst_mng_id
                _this.consultComInfo.cusMainManager_nm   = _this.consultSelInfo.cst_mng_nm;         // 
                _this.consultComInfo.cescoMainManager_nm = _this.consultSelInfo.cst_cesco_mng_nm;   // 
                _this.consultComInfo.sale_tp_cd          = _this.consultSelInfo.sale_tp_cd;         // 
                _this.consultComInfo.sale_mng_id         = _this.consultSelInfo.sale_mng_id;        // 매출사원
                _this.consultComInfo.sale_mng_nm         = _this.consultSelInfo.sale_mng_nm;        // 매출사원명

                return true;
            },

            // 컨설팅 수정
            openUptConsulRegPop: function(){
                
                let _this = this;
                _this.isReadonly = false;
                _this.isPartReadonly = false;                

                if(!_this.getConsultInfo()) return false;                

                // bill_no 관련 체크
                let chkBill = _this.consultSelInfo.fs_bill_no == null ? true : _this.consultSelInfo.fs_bill_no.length < 6;

                if(_this.userTpCd != '03'){
                    cmmAlert('관리자가 아닌 경우는 확인만 가능 합니다.')
                    _this.isReadonly = true;
                }
                else{
                    // if(_this.consultSelInfo.fs_status_cd !== '02'){
                    //     _this.isReadonly = true;
                    //     cmmAlert('상태 : [' + _this.consultSelInfo.fs_status_nm + '] 는 컨설팅 수정을 할 수 없습니다.')
                    // }else if(!chkBill){
                    //     _this.isReadonly = true;
                    //     _this.isPartReadonly = true;
                    //     cmmAlert('견적서가 있는 컨설팅은 담당자 변경만 가능 합니다.')
                    // }                    

                    // if(_this.consultSelInfo.fs_status_cd !== '02'){
                    //     _this.isReadonly = true;
                    //     cmmAlert('상태 : [' + _this.consultSelInfo.fs_status_nm + '] 는 컨설팅 수정을 할 수 없습니다.')
                    // }else if(!chkBill){
                    //     _this.isReadonly = true;
                    //     _this.isPartReadonly = true;
                    //     cmmAlert('견적서가 있는 컨설팅은 담당자 변경만 가능 합니다.')
                    // }
                    
                    if(_this.consultSelInfo.fs_status_cd === '01'){
                        cmmAlert('상태 : [' + _this.consultSelInfo.fs_status_nm + '] 는 컨설팅 수정을 할 수 없습니다.')
                        return false;
                    } 

                    if(!chkBill){
                        _this.isReadonly = true;
                        _this.isPartReadonly = true;
                        // cmmAlert('견적서가 있는 컨설팅은 담당자 변경만 가능 합니다.')
                    }else{
                        _this.consultSelInfo.fs_status_cd = '02';
                    }
                }

                _this.openNewConsultPop = true;
                _this.onDefaultReset();
            },

            // 의뢰 컨설팅 등록
            openRequestRegPop : function(){
                
                let _this = this;
                _this.isReadonly = false;
                _this.isPartReadonly = false;

                if(!_this.getConsultInfo()) return false;

                if(_this.consultSelInfo.fs_status_cd !== '01'){
                    cmmAlert('상태 : [' + _this.consultSelInfo.fs_status_nm + '] 는 컨설팅 의뢰 등록을 할 수 없습니다.')
                    return false;
                } 
                _this.openNewConsultPop = true;
                _this.onDefaultReset();
            },            

            // 계약자 정보 넣기
            setContInfo : function(data){
                let _this = this;
                if(_this.typeSailCont == 'C'){
                    _this.consultComInfo.cont_id = data.staff_id;
                    _this.consultComInfo.cont_nm = data.staff_nm;
                }else{
                    _this.consultComInfo.sale_mng_id = data.staff_id;
                    _this.consultComInfo.sale_mng_nm = data.staff_nm;
                }
                
            },

            // 그리드 내용 가운데 
            setDivCenter: function(val, tag){
                let inTag = "height:100%;";
                inTag += "display:flex;";
                inTag += "flex-direction:column;";
                inTag += "justify-content:center;";
                inTag += "align-items:center;";
                inTag += "word-break:break-all;";
                inTag += tag;

                return "<div style='" + inTag + "'>" + val + "</div>";
            },

            // 그리드 내용 오른쪽
            setDivRight: function(val, tag){
                let inTag = "height:100%;";
                inTag += "display:flex;";
                inTag += "flex-direction:column;";
                inTag += "justify-content:center;";
                inTag += "align-items:center;";
                inTag += "margin-right: 4px; float: right;";
                inTag += tag;

                return "<div style='" + inTag + "'>" + val + "</div>";
            },

            // 담당자 삭제
            setCusDel : function(cst_id){
                let _this = this;
                _this.cusList = this.cusList.filter((item,index)=> item.cst_id != cst_id);
                _this.managerList = this.managerList.filter((item,index)=> item.cst_id != cst_id);
            },

            // 담당자 저장
            setManagerList : function(data){
                let _this = this;
                _this.managerList = data;
            },

            // 현재구성 즐겨찾기 등록 팝업
            openCusFavoritesAdd : function(){
                this.openCusFavoritesAddPop = true;
            },

            // 현재구성 즐겨찾기 등록 팝업 닫기
            closeCusFavoritesAdd : function(){
                let _this = this;
                _this.openCusFavoritesAddPop = false;;
            },

            // 협력사 즐겨찾기 목록 팝업
            openCusFavoritesList : function() {
                this.openCusFavoritesListPop = true;
            },

            // 협력사 즐겨찾기 목록 팝업
            closeCusFavoritesList : function() {
                this.openCusFavoritesListPop = false;
            },

            // 협렵사 담당자 선택 팝업
            openManagerSearch : function(type){
                let _this = this;
                _this.managerPopType = type;
                _this.openManagerSearchPop = true;
            },

            // 협렵사 담당자 선택 팝업 닫기
            closeManagerSearchPop : function(){
                this.openManagerSearchPop = false;
            },

            // 협렵사 담당자 선택 팝업
            openContSearch : function(type){                
                this.typeSailCont = type;
                this.openContSearchPop = true;
            },

            // 협렵사 담당자 선택 팝업 닫기
            closeContSearchPop : function(){
                this.openContSearchPop = false;
            },

            // 담당자 팝업
            openMngPop: function(idxs) {
                let _this = this;
                let consultMngInfo = $("#jqxGrid").jqxGrid('getrowdata', idxs);
                let param = {};

                param.p_type = '1';
                param.sys_id =  consultMngInfo.sys_id;
                param.manager =  consultMngInfo.fs_mng_id;
                // 담당자 내역조회
                let url = '/api/consulting/getMngInfo';
                axiosCall('get', url, param, function(res){
                    _this.mngPop = true;
                    _this.consultingMng = res.data[0];
                });
            },

            // 담당자 팝업 닫기
            closeMngPop: function() {
                this.mngPop = false;
            },

            // 세스크 담당자 목록 가져오기
            getCescoManagerList : function(){
                let _this = this;
                let param = {
                    p_type : '2',
                    sys_id : 'FS',
                    cst_id : '10000000'
                }

                //세스코 담당자 목록 가져오기
                axiosCall('get', '/consult/api/managerList', param, function(response) {
                    let cescoManager = response.data;

                    cescoManager.forEach(manager => {
                        _this.cescoList.push(manager);
                        _this.comboCescoList.push(manager);
                    });
                });
            },

            // 고객사 정보 넣기
            setCuscomInfo : function(data){
                let _this = this;
                _this.consultComInfo.cst_id = data.cst_id;
                _this.consultComInfo.cst_nm = data.cst_nm;

                _this.managerList = [];
                _this.cusList = [];

                _this.getSalesConEmployeeList(_this.consultComInfo.cst_id, 'CF06', "saleMngList"); // CF06 : 담당지사(매출사원)
                _this.getSalesConEmployeeList(_this.consultComInfo.cst_id, 'CF02', "contMngList"); // CF02 : SD센터(계약사원)    

                _this.setManagerInfo(data);
            },

            setManagerInfo : function(data){

                let _this = this;
                let chkOverlap = false;

                _this.cusList.forEach(cus => {
                    if(cus.cst_id === data.cst_id) chkOverlap = true;
                });

                if(chkOverlap){
                    cmmAlert('이미 등록된 협력사 입니다.');
                    return false;
                }

                let param = {
                    p_type : '1',
                    sys_id : 'FS',
                    cst_id : data.cst_id
                }

                // 담당자 추가
                axiosCall('get', '/consult/api/managerList', param, function(response) {
                    let dataManager = response.data;

                    dataManager.forEach(manager => {
                        if(_this.openNewConsultPop){
                            manager.fs_bill_mng_yn = "N";
                            manager.fs_chat_yn = "N";
                        }
                        _this.managerList.push(manager);
                    });

                    // 협력사 추가
                    _this.cusList.push(data);
                });
                
            },

            setManagerListInfo : function(data){

                let _this = this;

                let bookMstList = [];

                data.forEach(addCos => {
                    bookMstList.push(addCos.book_seq);
                });

                let bookDtlList = [];
                _this.cusList.forEach(cus => {
                    bookDtlList.push(cus.cst_id);
                });

                let param = {
                    bookMstList : bookMstList.join(","),
                    bookDtlList : bookDtlList.join(",")
                }

                axiosCall('get', '/consult/api/getAddCusList', param, function(response) {
                    
                    response.data.forEach(cusInfo => {
                        let managerParam = {
                            p_type : '1',
                            sys_id : 'FS',
                            cst_id : cusInfo.cst_id 
                        }

                        axiosCall('get', '/consult/api/managerList', managerParam, function(response) {
                            let dataManager = response.data;

                            dataManager.forEach(manager => {
                                if(_this.openNewConsultPop){
                                    manager.fs_bill_mng_yn = "N";
                                    manager.fs_chat_yn = "N";
                                }
                                _this.managerList.push(manager);
                            });
                            // 협력사 추가
                            _this.cusList.push(cusInfo);
                        });
                    });
                });
                _this.closeCusFavoritesList();
            },            

            // 그리드 줄 높이
            setGridHeight: function(){
                // $('#jqxGrid').jqxGrid({ rowsheight: this.gridMaxCnt * 25});
                $('#jqxGrid').jqxGrid({ rowsheight: 60});
            },

            // 날짜 체크
            chkDate: function(val){

                let result = true;
                let _this = this;

                try {
                    if(_this.consultSearch.start_date == '' && _this.consultSearch.end_date == ''){
                        _this.searchDateType = 'all';
                    }
                    if(_this.searchDateType !== 'all'){
                        let dataformatRegexp = /([0-9]{4}-[0-9]{2}-[0-9]{2})/;

                        if ( !dataformatRegexp.test(val) ) {
                            cmmAlert("날짜는 yyyy-mm-dd 형식으로 입력해주세요.");
                            return false;
                        }
                    
                        let date = val.split("-");
                        let y = parseInt(date[0], 10),
                            m = parseInt(date[1], 10),
                            d = parseInt(date[2], 10);
                        
                        let datatimeRegexp = /^(?=\d)(?:(?:31(?!.(?:0?[2469]|11))|(?:30|29)(?!.0?2)|29(?=.0?2.(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00)))(?:\x20|$))|(?:2[0-8]|1\d|0?[1-9]))([-.\/])(?:1[012]|0?[1-9])\1(?:1[6-9]|[2-9]\d)?\d\d(?:(?=\x20\d)\x20|$))?(((0?[1-9]|1[012])(:[0-5]\d){0,2}(\x20[AP]M))|([01]\d|2[0-3])(:[0-5]\d){1,2})?$/;
                        result = datatimeRegexp.test(d+'-'+m+'-'+y);
                    }
                } catch (err) {
                    result = false;
                }

                if(!result)
                    cmmAlert('날짜 형식이 정확하지 않습니다.');

                return result;

            },

            // 검색 실행
            onSearchList: function(){
                let _this = this;
                 
                if(!_this.chkDate(_this.consultSearch.start_date))
                    return false;
                if(!_this.chkDate(_this.consultSearch.end_date))
                    return false;

                _this.drawGrid();
            },

            // 표시컨설팅 목록 가져오기
            drawGrid: function() {

                let _this = this;

                _this.gridMaxCnt = 3;                

                //  목록 가져오기
                axiosCall('get', '/consult/api/consultList', _this.consultSearch, function(response) {
                    let data = response.data;
                    // 데이터 타입, 필드, 셋팅할 데이터를 설정한다.
                    let source =  {
                        datatype: "json", // json 형태의 데이터를 셋팅할 것이고.
                        // 각필드의 이름과 타입은 datafields에 마찬가지로 json 형태이다.
                        datafields: [
                            // { name : 'check',               type : 'bool' },
                            { name : 'sys_id',              type : 'string' },
                            { name : 'cst_id',              type : 'string' },
                            { name : 'fs_no',               type : 'string' },      // 컨설팅번호
                            { name : 'cst_nm',              type : 'string' },      // 고객사명
                            { name : 'prod_nm',              type : 'string' },      // 제품명
                            { name : 'corp_nm',              type : 'string' },      // 협력사명
                            { name : 'cst_mng_id',          type : 'string' },      // 고객담당ID
                            { name : 'cst_mng_nm',          type : 'string' },      // 고객담당자명
                            { name : 'tax_bill_nm',         type : 'string' },      // 정산담당자명
                            { name : 'bill_cst_nm',         type : 'string' },      // 정산주체
                            { name : 'receive_date',        type : 'string' },      // 접수일자
                            { name : 'prod_ser_nm',         type : 'string' },      // 정기 비정정기 서비스구분명 => 서비스 구분
                            { name : 'tax_bill_email',      type : 'string' },      // 정산담당자이메일
                            { name : 'tax_bill_id',         type : 'string' },      // 정산담당자
                            { name : 'tax_bill_tp_cd',      type : 'string' },      // 계산서 선발행 여부
                            { name : 'fs_bill_item',        type : 'string' },      // 세금계산서 발행여부
                            { name : 'fs_bill_no',          type : 'string' },      // 세금계산서번호
                            { name : 'fs_mng_id',           type : 'string' },      // 세스코담당자ID
                            { name : 'cst_cesco_mng_nm',    type : 'string' },      // 세스코담당자ID
                            { name : 'cst_cesco_mng_nm',    type : 'string' },      // 세스코담당자명
                            { name : 'fs_status_cd',        type : 'string' },      // 진행상태 코드
                            { name : 'fs_status_nm',        type : 'string' },      // 진행상태명
                            { name : 'mem_cnt',             type : 'string' },      // 참여자수
                            { name : 'est_amt',             type : 'number' },      // 견적금액
                            { name : 'cont_id',             type : 'string' },      // 계약사원 ID
                            { name : 'cont_nm',             type : 'string' },      // 계약사원 명
                            { name : 'mdfr_dt',             type : 'string' },      // 수정일
                            { name : 'sale_tp_cd',          type : 'string' },       // 매출구분
                            { name : 'sale_tp_nm',          type : 'string' },       // 매출구분
                            { name : 'bill_ar_nm',          type : 'string' },        // 대금수금구분명
                            { name : 'sale_mng_id',         type : 'string' },        // 매출사원 ID
                            { name : 'sale_mng_nm',         type : 'string' }        // 매출사원 명
                            
                        ],
                        localdata: data // 위에서 셋팅해놓은 data를 localdata에 담아준다.  
                    };

                    // jqxgrid 프레임워크에서 만든 dataAdapter object를 생성하여  
                    // 위에서 셋팅한 source의 정보를 넣어준다.  
                    let dataAdapter = new $.jqx.dataAdapter(source);

                    $('#jqxGrid').jqxGrid('clearselection');
                    $("#jqxGrid").jqxGrid({
                        width               :   '100%',
                        autoheight          :   true,
                        source              :   dataAdapter,
                        selectionmode       :   'singlerow',
                        pageable			:   true,
                        pagermode			:   'simple',
                        pagesize			:   100,
                        pagerbuttonscount	:   10,
                        columnsheight       :   60,
                        rowsheight          :   60,      
                        editmode            :   'selectedrow',
                        localization        : { emptydatastring:'해당 자료가 존재하지 않습니다.' },
                        editable            :   true,
                        columns: [
                            { 
                                text: '', datafield: 'check', columntype: 'checkbox', width: 30
                            },
                            {
                                text: '순번', sortable: false, filterable: false, editable: false,
                                groupable: false, draggable: false, resizable: false,
                                cellsalign: 'center', align : 'center',
                                datafield: '', columntype: 'number', width: '3%',
                                cellsrenderer: function (row, column, value) {
                                    return _this.setDivCenter((value + 1));
                                }
                            },
                            { 
                                text : '고객사 / 컨설팅번호', datafield : 'fs_no', cellsalign: 'center', align : 'center', width : '160', editable: false
                                , cellsrenderer: function (row, columnfield, value, defaulthtml, columnproperties, rowdata) {
                                    return _this.setDivCenter(rowdata.cst_nm + "<br>" + value);
                                }
                            },
                            { 
                                text : '제품명 / 식품유형', datafield : 'prod_nm', cellsalign: 'center', align : 'center', width : '13%', editable: false
                                , cellsrenderer: function (row, column, value) {
                                    let arrVal = value.split(',');
                                    let viewVal = '';

                                    arrVal.forEach((element, index) => {
                                        if(index < 3){
                                            if(index != 0)
                                                viewVal += "<br>";
                                            viewVal += element;
                                            if(index == 2)
                                                viewVal += " 외 " + (arrVal.length - 3) + "건";
                                        }                                        

                                        // _this.gridMaxCnt = _this.gridMaxCnt < (index + 1) ? (index + 1) : _this.gridMaxCnt;                                        
                                    });                                

                                    return _this.setDivCenter(viewVal, 'font-size:13px;');
                                }
                            },
                            { 
                                text : '매출구분', datafield : 'sale_tp_nm', cellsalign: 'center', align : 'center', width : '120', editable: false
                                , cellsrenderer: function (row, column, value) {
                                    return _this.setDivCenter(value, 'font-size:13px;');
                                }
                            },
                            { 
                                text : '대금수금구분', datafield : 'bill_ar_nm', cellsalign: 'center', align : 'center', width : '120', editable: false
                                , cellsrenderer: function (row, column, value) {
                                    return _this.setDivCenter(value, 'font-size:13px;');
                                }
                            },
                            { 
                                text : '컨설팅참여자', datafield : 'corp_nm', cellsalign: 'center', align : 'center', width : '200', editable: false
                                , cellsrenderer: function (row, column, value) {
                                    let arrVal = value.split(',');
                                    let viewVal = '';

                                    if(value == '' || value == null){
                                        viewVal = '';
                                    }else{
                                        arrVal.forEach((element, index) => {
                                            if(index < 3){
                                                if(index != 0)
                                                    viewVal += "<br>";
                                                viewVal += element;
                                                if(index == 2)
                                                    viewVal += " 외 " + (arrVal.length - 3) + "명";
                                            }                                             

                                            // _this.gridMaxCnt = _this.gridMaxCnt < (index + 1) ? (index + 1) : _this.gridMaxCnt;
                                        }); 
                                    }

                                    return _this.setDivCenter(viewVal, 'font-size:12px;');
                                }
                            },
                            { 
                                text : '고객사담당자 / 정산주체 / 접수일시 / 서비스구분', datafield : 'cst_mng_nm', editable: false,       cellsalign: 'center', align : 'center', width : '230',
                                    renderer: function () {
                                        return _this.setDivCenter('고객사담당자 / 정산주체<br />접수일시 / 서비스구분');
                                    }
                                    , cellsrenderer: function (row, columnfield, value, defaulthtml, columnproperties, rowdata) {

                                        let cst_mng_nm = rowdata.cst_mng_nm == null ? '' : rowdata.cst_mng_nm;

                                        return _this.setDivCenter(cst_mng_nm + " / " + rowdata.bill_cst_nm + "<br>" + rowdata.receive_date + " / " + rowdata.prod_ser_nm);
                                    }  
                                },
                            { 
                                text : '정산담당자 수신이메일/담당자', datafield : 'tax_bill_email', editable: false,   cellsalign: 'center', align : 'center', width : '200',
                                renderer: function () {
                                    return _this.setDivCenter('&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;정산담당자 <br />수신이메일/담당자');
                                } 
                                , cellsrenderer: function (row, columnfield, value, defaulthtml, columnproperties, rowdata) {
                                    if(rowdata.tax_bill_nm == null){
                                        return '';
                                    }else{
                                        return _this.setDivCenter( value  + "<br>" + rowdata.tax_bill_nm);
                                    }                                    
                                }
                            },
                            { 
                                text : '서비스견적서발행여부 / 번호', datafield : 'fs_bill_item', editable: false,     cellsalign: 'center', align : 'center', width : '8%',
                                renderer: function () {
                                    return _this.setDivCenter('&nbsp;&nbsp;&nbsp;서비스견적서<br />&nbsp;&nbsp;발행여부 / 번호');
                                }
                                , cellsrenderer: function (row, columnfield, value, defaulthtml, columnproperties, rowdata) {
                                    return _this.setDivCenter( value );
                                }
                            },
                            { 
                                text : '세스코담당자', datafield : 'cst_cesco_mng_nm', editable: false, cellsalign: 'center', align : 'center', width : '7%'
                                , cellsrenderer: function (row, column, value) {
                                    return _this.setDivCenter( value );
                                }
                            },
                            { 
                                text : '진행상태', datafield : 'fs_status_nm', editable: false,          cellsalign: 'center', align : 'center', width : '6%'
                                , cellsrenderer: function (row, column, value) {
                                    return _this.setDivCenter(value);
                                }
                            },
                            { 
                                text : '견적합계',  datafield : 'est_amt', editable: false,          cellsalign: 'center', align : 'center', width : '7%', cellsformat: 'd'
                                , cellsrenderer: function (row, column, value) {
                                    return _this.setDivRight(value.toLocaleString('ko-KR'));
                                }
                            },
                            { 
                                text : '최종처리일시', datafield : 'mdfr_dt', editable: false,          cellsalign: 'center', align : 'center', width : '7%'
                                , cellsrenderer: function (row, column, value) {
                                    return _this.setDivCenter(value.substring(0,10));
                                }
                            }
                        ]
                    });
                    _this.setGridHeight();
                });

                $("#jqxGrid").off('pagechanging').on('pagechanging', function (event) {

                    _this.gridMaxCnt = 3;
                    let pagenum = event.args.pagenum;
                    let pagesize = event.args.pagesize;
                    
                    let rows = $('#jqxGrid').jqxGrid('getrows');

                    $.each(rows, function(idx, obj){
                        if(idx > pagenum * pagesize - 1 && idx <= (pagenum + 1) * pagesize - 1 && obj.prod_nm != null){

                            let arrVal = obj.prod_nm.split(',');                            
                            
                            arrVal.forEach((element, index) => {                 
                                _this.gridMaxCnt = _this.gridMaxCnt < (index + 1) ? (index + 1) : _this.gridMaxCnt;

                                // if(element.length > 14){
                                //     _this.gridMaxCnt+=2;
                                // }                                
                            });
                        }  

                        if(idx > pagenum * pagesize - 1 && idx <= (pagenum + 1) * pagesize - 1 && obj.corp_nm != null){

                            let arrVal = obj.corp_nm.split(',');

                            arrVal.forEach((element, index) => {                                
                                _this.gridMaxCnt = _this.gridMaxCnt < (index + 1) ? (index + 1) : _this.gridMaxCnt;

                                // if(element.length > 14){
                                //     _this.gridMaxCnt+=2;
                                // }
                            });
                        } 
                        
                        obj.check = false;
                    });

                    _this.setGridHeight();
                });

            },

            onChangeStartDate: function(val) {
                this.searchDateType = 'keyup';
				this.consultSearch.start_date = val;
                this.setSearchInfo();
            },
            
            onChangeEndDate: function(val) {
                this.searchDateType = 'keyup';
                this.consultSearch.end_date = val;
                this.setSearchInfo();                
            },

            setPeriod: function(e,val) {
                let _this = this;
                _this.searchDateType = val;
                $('.but-tiem').removeClass('mini-btns-togger')
                e.target.setAttribute('class','but-tiem mini-btns-togger')
                var periodDate = getPeriod(val);
                _this.consultSearch.start_date = periodDate.startDt;
                _this.consultSearch.end_date = periodDate.endDt;
                _this.setSearchInfo();
            },

            // 조회기간에 따른 조회 조건 변경
            setSearchInfo: function(){
                let _this = this;

                if(_this.userTpCd === '02'){                    
                    _this.cusPtype                = '02',           // 고객사 p_type(운영자 : 02)
                    _this.cescoPtype              = '02',           // 세스코 p_type(운영자 : 02)
                    _this.managerPtype            = '01'           // 담당자 p_type(운영자 : 01)
                }

                let param = [
                    {cmm_cd:'cst', p_type: _this.cusPtype, 
                        p_parm4:_this.consultSearch.start_date,p_parm5:_this.consultSearch.end_date,arr_nm:'searchComboCus', comboType:'all'}, //고객사 구분
                    {cmm_cd:'mng', p_type: _this.managerPtype, 
                        p_parm4:_this.consultSearch.start_date,p_parm5:_this.consultSearch.end_date, 
                        arr_nm:'searchComboManager', comboType:'all'}, // 담당자
                    {cmm_cd:'mng', p_type: _this.cescoPtype, 
                        p_parm4:_this.consultSearch.start_date,p_parm5:_this.consultSearch.end_date, 
                        arr_nm:'searchComboCes', comboType:'all'}, // 세스코 담당자
                ];

                if(!_this.bSearchCombo){
                    param.push({cmm_cd:'FS004', arr_nm:'searchComboStep', comboType:'all',cmm_type:'02'});      //조회 진행 단계
                    param.push({cmm_cd:'FS001', arr_nm:'searchComboFType'});                   //조회 식품 유형                                    
                    param.push({sys_cd:'FS',   cmm_cd:'FS005', arr_nm:'cusServiceTypeList', comboType:'select'});   // 서비스구분 목록
                    param.push({sys_cd:'FS',   cmm_cd:'FS002', arr_nm:'cusUnitpriceTypeList', comboType:'select'}); // 단가구분 목록
                    param.push({sys_cd:'FS',   cmm_cd:'FS006', arr_nm:'cusBillTypeList'});                          // 세금계산서발행구분 목록
                    param.push({sys_cd:'FS',   cmm_cd:'FS001', arr_nm:'cusFoodTypeList'});                          // 식품유형 목록 FS001
                    param.push({sys_cd:'FS',   cmm_cd:'FS028', arr_nm:'cusSaleTypeList', comboType:'select'});      // 매출구분 목록 FS028
                    param.push({sys_cd:'FS',   cmm_cd:'FS028', arr_nm:'searchComboSailType', comboType:'all'});     // 매출구분 FS028
                    param.push({sys_cd:'FS',   cmm_cd:'FS007', arr_nm:'searchComboBillType', comboType:'all'});     // 대금수금구분 FS028
                    _this.bSearchCombo = true;
                }
                
                _this.consultSearch.manager = '';
			    _this.consultSearch.customer = '';
			    _this.consultSearch.cesco_person_in_charge = '';

                getCodeListForArrNm(param, _this);
            },

            onSelKeyUpSh: function(e, divId, ulId){
                let _this = this;                
                if(e.keyCode == 13){
                    _this.bSearchFtypeSh = false;
                    return false;
                }

                if(e.keyCode == 38 || e.keyCode == 40){ 
                // if(e.keyCode == 40){ 
                    _this.licnt = e.keyCode == 40 ? _this.licnt + 1 : _this.licnt - 1;
                    _this.licnt = _this.licnt == $('#' + ulId + ' li').length ? $('#' + ulId + ' li').length - 1 : _this.licnt;
                    _this.licnt = _this.licnt < 0 ? _this.licnt = 0 : _this.licnt;

                    let scrollH = parseInt($('#' + divId).prop('scrollHeight'));
                    $('#' + divId).scrollTop(_this.licnt * (scrollH / $('#' + ulId + ' li').length) - 20);
                    
                    $.each($('#' + ulId + ' li'), function(idx, obj){
                        if(idx == _this.licnt){
                            // $(obj).css("background-color","#f1f1f1");
                            $(obj).css("background-color","#1E90FF");
                            $(obj).css("color","#FFFFFF");
                            $(obj).css("cursor","pointer");
                            _this.consultSearch.food_type = String(obj.dataset.tpcd);
                            _this.consultSearch.food_type_nm = String(obj.innerText);
                        }else{
                            $(obj).css("background-color","");
                            $(obj).css("color","");
                            $(obj).css("cursor","");
                        }
                    });
                }
            },

            onDeptKeyUpSh: function(e){
                let _this = this; 
                let val = e.target.value;
                _this.consultSearch.food_type = '';
                _this.licnt = -1;

                _this.topSearchComList = _this.searchComboFType.filter((item,index)=> item.cmm_dtl_nm.indexOf(val) > -1);
                _this.bSearchFtypeSh = true;
            },

            selComInfoSh: function(code, name){
                let _this = this;
                _this.consultSearch.food_type = code;
                _this.consultSearch.food_type_nm = name;
                _this.bSearchFtypeSh = false;                
            },

            // 매출 / 계약 사원 목록 
            getSalesConEmployeeList: function(cst_id, centercd, arrList){                
                let _this = this;
                let param = {
                    sys_id : 'FS',
                    cst_id : cst_id,
                    centercd : centercd
                }
                _this[arrList] = [];
                axiosCall('get', '/api/hcConsultMgt/salesConEmployee', param, function(response) {                    
                    _this[arrList] = response.data;                    
                    // if(arrList == 'saleMngList'){
                    //     if(_this[arrList].length > 0 && _this.consultComInfo.sale_mng_id == ''){
                    //         _this.consultComInfo.sale_mng_id = _this[arrList][0].user_num;
                    //     }
                    // }
                });
            },

            onDownloadXls: function(){                
                let _this = this;

                //  목록 가져오기
                axiosCall('get', '/consult/api/consultListXls', _this.consultSearch, function(response) {
                    let data = response.data;                    
                    
                    let source =  {  
                        datatype: "json",                         
                        datafields: [ 

                            { name : 'sys_id',              type : 'string' },
                            { name : 'cst_id',              type : 'string' },
                            { name : 'cst_nm',              type : 'string' },      // 고객사명
                            { name : 'fs_no',               type : 'string' },		// 컨설팅번호
                            { name : 'fs_seq',              type : 'string' },		// 컨설팅번호순번
                            { name : 'reg_channel',         type : 'string' },      // 컨설팅등록구분
                            { name : 'reg_channel_nm',      type : 'string' },      // 컨설팅등록구분명
                            { name : 'rgstr_id',            type : 'string' },      // 등록자  
                            { name : 'rgstr_nm',            type : 'string' },      // 등록자
                            { name : 'receive_date',        type : 'string' },      // 접수일자
                            { name : 'issue_date',          type : 'string' },      // 확인이자
                            { name : 'close_date',          type : 'string' },      // 종료일자
                            { name : 'prod_nm',             type : 'string' },		// 고객이 등록한 제품명
                            { name : 'prod_tp_cust_nm',     type : 'string' },	    // 고객이 등로한 식품유형명
                            { name : 'prod_mafa_nm',        type : 'string' },      // 고객이 등록한 제조업체명
                            { name : 'prod_tp_cd',          type : 'string' },      // 식품유형코드
                            { name : 'prod_tp_nm',          type : 'string' },      // 식품유형코드명
                            { name : 'corp_nm',             type : 'string' },      // 참여자명
                            { name : 'prod_item',           type : 'string' },		// 품목번호
                            { name : 'prod_qty_nm',         type : 'string' },      // 내용물
                            { name : 'cst_mng_id',          type : 'string' },		// 고객담당자
                            { name : 'cst_mng_nm',          type : 'string' },      // 고객담당자명
                            { name : 'cst_mng_mobile',      type : 'string' },      // 담당자연락처
                            { name : 'bill_cst_id',         type : 'string' },		// 정산거래처 :  신청시 등록시 넣는다.
                            { name : 'bill_cst_nm',         type : 'string' },      // 정산거래처명
                            { name : 'prod_ser_cd',         type : 'string' },		// 정기 비정정기 서비스구분  
                            { name : 'prod_ser_nm',         type : 'string' },      // 서비스구분명
                            { name : 'prod_unit_cd',        type : 'string' },	    // 단가구분(의뢰구분)
                            { name : 'prod_unit_nm',        type : 'string' },      // 의뢰구분
                            { name : 'tax_bill_id',         type : 'string' },      // 정산담당자
                            { name : 'tax_bill_nm',         type : 'string' },      // 정산담당자명
                            { name : 'tax_bill_email',      type : 'string' },      // 정산담당자이메일
                            { name : 'est_tp_cd',           type : 'string' },      // 견적금액구분
                            { name : 'est_tp_nm',           type : 'string' },      // 견적금액구분명
                            { name : 'fs_bill_yn',          type : 'string' },      // 서비스견적서발행유무
                            { name : 'fs_bill_no',          type : 'string' },      // 서비스견적서번호
                            { name : 'tax_bill_yn',         type : 'string' },      // 세금계산서 발행여부
                            { name : 'tax_bill_no',         type : 'string' },      // 세금계산서 번호
                            { name : 'tax_bill_tp_cd',      type : 'string' },      // 세금계산서 발행구분
                            { name : 'tax_bill_tp_nm',      type : 'string' },      // 세금계산서 발행구분명
                            { name : 'bill_ar_cd',          type : 'string' },      // 수금 미수금
                            { name : 'bill_ar_nm',          type : 'string' },      // 수금 미수금
                            { name : 'fs_mng_id',           type : 'string' },		// 세스코담당자
                            { name : 'cst_cesco_mng_nm',    type : 'string' },      // 세스코담당자명
                            { name : 'fs_status_cd',        type : 'string' },	    // 진행상태
                            { name : 'fs_status_nm',        type : 'string' },      // 진행상태명
                            { name : 'mem_cnt',             type : 'string' },      // 참여자수
                            { name : 'est_amt',             type : 'number' },      // 견적금액
                            { name : 'mdfr_dt',             type : 'string' },      // 수정일자
                            { name : 'cont_no',             type : 'string' },      //  계약번호
                            { name : 'cont_id',             type : 'string' },      //  계약자
                            { name : 'cont_nm',             type : 'string' },      //  계약자명
                            { name : 'read_yn',             type : 'string' },      //  챗팅방 모두읽었나 안읽었나
                            { name : 'sale_tp_cd',          type : 'string' },		//  매출 구분
                            { name : 'sale_tp_nm',          type : 'string' },      //  매출 구분명
                            { name : 'sale_mng_id',         type : 'string' },      //  매출 사원
                            { name : 'sale_mng_nm',         type : 'string' },      //  매출 사원명

                            { name : 'prod_nm1',            type : 'string' },      // 제품명 
                            { name : 'prod_nm2',            type : 'string' },      // 식품유형
                            { name : 'corp_id',             type : 'string' },      // 참여자id목록
                            { name : 'fs_bill_item',        type : 'string' },      // 견적서 생성여부
                            { name : 'tax_bill_item',       type : 'string' },      // 세금계산서생성여부
                            { name : 'cont_dept_cd',       type : 'string' },       // 계약부서코드
                            { name : 'cont_dept_nm',       type : 'string' },       // 계약부서명
                            { name : 'sale_dept_cd',       type : 'string' },       // 매출부서코드
                            { name : 'sale_dept_nm',       type : 'string' },       // 매출부서명
                        ],	
                        localdata: data 
                    };

                    let dataAdapter = new $.jqx.dataAdapter(source);

                    $('#jqxXls').jqxGrid('clearselection');
                    $("#jqxXls").jqxGrid({                        
                        width               : '100%',
                        height				: 	0,
                        source              :   dataAdapter,                            
                        localization        : { emptydatastring:'해당 자료가 존재하지 않습니다.' },
                        columns: [

                            {   width: 100, datafield : 'prod_ser_nm',      cellsalign: 'center', align : 'center', text : '서비스구분명' },
                            {   width: 100, datafield : 'sale_tp_nm',       cellsalign: 'center', align : 'center', text : '매출 구분' },
                            {   width: 100, datafield : 'bill_ar_nm',       cellsalign: 'center', align : 'center', text : '대금수금구분' },
                            {   width: 150, datafield : 'cst_nm',           cellsalign: 'center', align : 'center', text : '고객사' },
                            {   width: 100, datafield : 'cst_mng_nm',       cellsalign: 'center', align : 'center', text : '고객사 담당자' },
                            {   width: 120, datafield : 'fs_no',            cellsalign: 'center', align : 'center', text : '컨설팅번호' },
                            {   width: 140, datafield : 'prod_tp_nm',       cellsalign: 'center', align : 'center', text : '식품유형' },
                            {   width: 100, datafield : 'prod_nm',          cellsalign: 'center', align : 'center', text : '제품명' },
                            {   width: 100, datafield : 'prod_mafa_nm',     cellsalign: 'center', align : 'center', text : '제조사' },
                            {   width: 100, datafield : 'est_amt',          cellsalign: 'center', align : 'center', text : '금액', cellsformat: 'd' },
                            {   width: 100, datafield : 'receive_date',     cellsalign: 'center', align : 'center', text : '접수일' },
                            {   width: 100, datafield : 'prod_item',        cellsalign: 'center', align : 'center', text : '품목보고번호' },
                            {   width: 100, datafield : 'prod_unit_nm',     cellsalign: 'center', align : 'center', text : '의뢰구분' },
                            {   width: 120, datafield : 'fs_bill_no',       cellsalign: 'center', align : 'center', text : '서비스견적서번호' },
                            {   width: 120, datafield : 'tax_bill_no',      cellsalign: 'center', align : 'center', text : '주문서 번호' },                            
                            {   width: 100, datafield : 'cst_cesco_mng_nm', cellsalign: 'center', align : 'center', text : '세스코담당자명' },
                            {   width: 100, datafield : 'fs_status_nm',     cellsalign: 'center', align : 'center', text : '진행상태' },
                            {   width: 100, datafield : 'cont_nm',          cellsalign: 'center', align : 'center', text : '계약자명' },
                            {   width: 160, datafield : 'cont_dept_nm',      cellsalign: 'center', align : 'center', text : '계약자 소속 부서' },
                            // {   width: 100, datafield : 'fs_seq',           cellsalign: 'center', align : 'center', text : '컨설팅번호순번' },                            
                            // {   width: 100, datafield : 'prod_tp_cd',       cellsalign: 'center', align : 'center', text : '식품유형코드' },
                            // {   width: 100, datafield : 'prod_tp_cust_nm',  cellsalign: 'center', align : 'center', text : '고객이 등로한 식품유형명' },
                            // {   width: 200, datafield : 'prod_nm1',         cellsalign: 'center', align : 'center', text : '제품명' },
                            // {   width: 200, datafield : 'prod_nm2',         cellsalign: 'center', align : 'center', text : '식품유형' },
                            // {   width: 200, datafield : 'corp_id',          cellsalign: 'center', align : 'center', text : '참여자id목록' },
                            // {   width: 200, datafield : 'fs_bill_item',     cellsalign: 'center', align : 'center', text : '견적서 생성여부' },
                            // {   width: 200, datafield : 'tax_bill_item',    cellsalign: 'center', align : 'center', text : '세금계산서생성여부' },
                            // {   width: 200, datafield : 'reg_channel',      cellsalign: 'center', align : 'center', text : '컨설팅등록구분' },
                            // {   width: 200, datafield : 'reg_channel_nm',   cellsalign: 'center', align : 'center', text : '컨설팅등록구분명' },
                            // {   width: 200, datafield : 'rgstr_nm',         cellsalign: 'center', align : 'center', text : '등록자' },                            
                            // {   width: 200, datafield : 'issue_date',       cellsalign: 'center', align : 'center', text : '확인일자' },
                            // {   width: 200, datafield : 'close_date',       cellsalign: 'center', align : 'center', text : '종료일자' },                            
                            // {   width: 400, datafield : 'corp_nm',          cellsalign: 'center', align : 'center', text : '참여자명' },                            
                            // {   width: 200, datafield : 'prod_qty_nm',      cellsalign: 'center', align : 'center', text : '내용물' },
                            // {   width: 200, datafield : 'cst_mng_id',       cellsalign: 'center', align : 'center', text : '고객담당자' },                            
                            // {   width: 200, datafield : 'cst_mng_mobile',   cellsalign: 'center', align : 'center', text : '담당자연락처' },
                            // {   width: 200, datafield : 'bill_cst_id',      cellsalign: 'center', align : 'center', text : '정산거래처' },
                            // {   width: 200, datafield : 'bill_cst_nm',      cellsalign: 'center', align : 'center', text : '정산거래처명' },
                            // {   width: 200, datafield : 'prod_ser_cd',      cellsalign: 'center', align : 'center', text : '서비스구분' },                            
                            // {   width: 200, datafield : 'prod_unit_cd',     cellsalign: 'center', align : 'center', text : '단가구분(의뢰구분)' },                            
                            // {   width: 200, datafield : 'tax_bill_id',      cellsalign: 'center', align : 'center', text : '정산담당자' },
                            // {   width: 200, datafield : 'tax_bill_nm',      cellsalign: 'center', align : 'center', text : '정산담당자명' },
                            // {   width: 200, datafield : 'tax_bill_email',   cellsalign: 'center', align : 'center', text : '정산담당자이메일' },
                            // {   width: 200, datafield : 'est_tp_cd',        cellsalign: 'center', align : 'center', text : '견적금액구분' },
                            // {   width: 200, datafield : 'est_tp_nm',        cellsalign: 'center', align : 'center', text : '견적금액구분명' },
                            // {   width: 200, datafield : 'fs_bill_yn',       cellsalign: 'center', align : 'center', text : '서비스견적서발행유무' },                            
                            // {   width: 200, datafield : 'tax_bill_yn',      cellsalign: 'center', align : 'center', text : '세금계산서 발행여부' },                            
                            // {   width: 200, datafield : 'tax_bill_tp_cd',   cellsalign: 'center', align : 'center', text : '세금계산서 발행구분' },
                            // {   width: 200, datafield : 'tax_bill_tp_nm',   cellsalign: 'center', align : 'center', text : '세금계산서 발행구분명' },
                            // {   width: 200, datafield : 'bill_ar_cd',       cellsalign: 'center', align : 'center', text : '수금 미수금' },                            
                            // {   width: 200, datafield : 'fs_mng_id',        cellsalign: 'center', align : 'center', text : '세스코담당자' },                            
                            // {   width: 200, datafield : 'fs_status_cd',     cellsalign: 'center', align : 'center', text : '진행상태' },                            
                            // {   width: 200, datafield : 'mem_cnt',          cellsalign: 'center', align : 'center', text : '참여자수' },
                            // {   width: 200, datafield : 'mdfr_dt',          cellsalign: 'center', align : 'center', text : '수정일자' },
                            // {   width: 200, datafield : 'cont_no',          cellsalign: 'center', align : 'center', text : '계약번호' },
                            // {   width: 200, datafield : 'cont_id',          cellsalign: 'center', align : 'center', text : '계약자ID' },                            
                            // {   width: 200, datafield : 'read_yn',          cellsalign: 'center', align : 'center', text : '챗팅방 모두읽었나 안읽었나' },
                            // {   width: 200, datafield : 'sale_tp_cd',       cellsalign: 'center', align : 'center', text : '매출 구분' },                            
                            // {   width: 200, datafield : 'sale_mng_id',      cellsalign: 'center', align : 'center', text : '매출 사원' },
                            // {   width: 200, datafield : 'sale_mng_nm',      cellsalign: 'center', align : 'center', text : '매출 사원명' },
                            
                        ]
                    });

                    if(data.length > 0){
                        $("#jqxXls").jqxGrid('exportdata', 'xls', '컨설팅 관리 목록', true);
                    }else{
                        cmmAlert('조회 정보가 없습니다.');
                    }
                    
                });
                
            },

            delConsult:function(){
                
                let _this = this;
                let chkCnt = 0;
                let delFs_no = '';
                let arrBill = [];
                let fs_status_cd = '';

                var rowDatas = $("#jqxGrid").jqxGrid('getrows');
                $.each(rowDatas, function(i, obj) {
                    if(obj.check == true){
                        chkCnt++;

                        fs_status_cd = obj.fs_status_cd;

                        if(obj.fs_bill_item === null){
                            arrBill.push("N");
                        }else{
                            arrBill = obj.fs_bill_item.split('/');
                        }
                        
                        delFs_no = obj.fs_no;
                    }

                    if(chkCnt > 1){
                        return false;
                    }
                })                

                if(chkCnt > 1){
                    cmmAlert('컨설팅 선택은 하나만 가능 합니다.');
                    return false;
                }

                if(chkCnt < 1){
                    cmmAlert('컨설팅을 선택해 주세요.');
                    return false;
                }

                if(fs_status_cd != '02' && fs_status_cd != '01'){
                    cmmAlert('진행중인 컨설팅은 <br>삭제가 불가능 합니다.');
                    return false;
                }

                if(arrBill[0] == 'Y'){
                    cmmAlert('서비스 견적서가 발행된 컨설팅은 <br>삭제가 불가능 합니다.');
                    return false;
                }
                
                cmmConfirm("[ "+delFs_no+" ] 컨설팅을 삭제 하시겠습니까?", function() {                    
                    axiosCall('post', '/consult/api/consultDel', {fs_no:delFs_no}, function(response) {
                        cmmAlert(response.data);
                        _this.drawGrid();
                    });
                });

            }
            
		}
	})    
});
</script>
</head>
<body>    
	<section layout:fragment="content" id="app"  v-cloak>
		<div class="page-head">
            <!-- content -->
            <div class="page-content flex-layout pdb0">
                <div class="page-box">
                    <div class="clear">
                        <h2 class="page-title fl">컨설팅 관리</h2>
                            <div class="fr">
                                <button class="btn-search" @click="onSearchList"><i></i>조회</button>
                            </div>
                    </div>
                    <hr>
                    <div class="board-search mgt20">
                        <table>
                            <colgroup><col width="60px"><col width="310px"><col width="110px"><col width=""><col width="110px"><col width=""><col width="110px"><col width=""></colgroup>
                            <tbody>
                                <tr>
                                    <th rowspan="2" class="valign-b th-pd">접수일</th>
                                    <td rowspan="2" class="valign-b">
                                        <div class="mini-btns">
                                            <button id="time01" @click="setPeriod($event,'currentMonth')">당월</button>
                                            <button id="time02" @click="setPeriod($event,'currentYear')">당해</button>
                                            <button id="time03" @click="setPeriod($event,'oneMonth')">1개월</button>
                                            <button id="time04" @click="setPeriod($event,'threeMonth')">3개월</button>
                                            <button id="time05" @click="setPeriod($event,'sixMonth')">6개월</button>
                                            <button id="time06" @click="setPeriod($event,'oneYear')">1년</button>
                                            <button id="time07" @click="setPeriod($event,'all')">전체</button><!-- 2022.12.09 검색조건 "전체" 추가 -->
                                        </div>
                                        <div class="calendar-wrap">
                                            <div class="calendar-wrap">
                                                <span class="calendar-box">
                                                    <date-picker-from 
                                                        name="startDate" 
                                                        type="text" 
                                                        id="startDate" 
                                                        size="12" 
                                                        title="서비스/장비설치 요청일" 
                                                        :val="consultSearch.start_date" 
                                                        v-model="consultSearch.start_date" 
                                                        @on-change-start-date="onChangeStartDate" 
                                                    />
                                                    <label for="startDate"></label>
                                                </span>
                                                <span class="dash">~</span>
                                                <span class="calendar-box">
                                                    <date-picker-to 
                                                        name="endDate" 
                                                        type="text" 
                                                        id="endDate" size="12" 
                                                        title="서비스/장비설치 요청일" 
                                                        :val="consultSearch.end_date" 
                                                        v-model="consultSearch.end_date"  
                                                        @on-change-end-date="onChangeEndDate"
                                                    />
                                                    <label for="endDate"></label>
                                                </span>
                                            </div>
                                        </div>
                                    </td>
                                    <th>진행단계</th>
                                    <td>
                                        <select class="full"  v-model="consultSearch.fs_status_cd">
                                            <option :key="index" :value="item.cmm_dtl_cd" v-for="(item, index) in searchComboStep">{{item.cmm_dtl_nm}}</option>
                                        </select>
                                    </td>
                                    <th>고객사</th>
                                    <td>
                                        <select class="full" v-model="consultSearch.customer">
                                            <option :key="index" :value="item.cmm_dtl_cd" v-for="(item, index) in searchComboCus">{{item.cmm_dtl_nm}}</option>
                                        </select>
                                    </td>
                                    <th>식품유형</th>
                                    <td>
                                        <div class="auto-search-wrap">
                                            <div class="auto-search-title">                                                    
                                                <input type="text" v-model="consultSearch.food_type_nm" maxlength="50" class="full" placeholder="식품유형을 입력하세요" 
                                                @input="onDeptKeyUpSh($event)" 
                                                @click="onDeptKeyUpSh($event)" 
                                                @keyup="onSelKeyUpSh($event, 'topSearchList', 'topChkLi')" 
                                                autocomplete='off' 
                                                name= "inputTopCom">
                                            </div>
                                            <div v-if="bSearchFtypeSh" class="auto-search-list" :id="'topSearchList'">
                                                <div>
                                                    <ul :id="'topChkLi'">
                                                        <li @click="selComInfoSh(item.cmm_dtl_cd, item.cmm_dtl_nm)"  :key="idx" v-for="(item, idx) in topSearchComList" :value="item.cmm_dtl_cd" v-bind:data-tpcd="item.cmm_dtl_cd" >{{item.cmm_dtl_nm}}</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <th>제품명</th>
                                    <td><input type="text" v-model="consultSearch.product_name" class="full" placeholder="제품명을 입력하세요" @keyup.enter="drawGrid"></td>
                                    <th>담당자</th>
                                    <td>
                                        <select class="full" v-model="consultSearch.manager">
                                            <option :key="index" :value="item.cmm_dtl_cd" v-for="(item, index) in searchComboManager">{{item.cmm_dtl_nm}}</option>
                                        </select>
                                    </td> 
                                    <th>세스코담당자</th>
                                    <td>
                                        <select class="full" v-model="consultSearch.cesco_person_in_charge">
                                            <option :key="index" :value="item.cmm_dtl_cd" v-for="(item, index) in searchComboCes">{{item.cmm_dtl_nm}}</option>
                                        </select>
                                    </td>
                                </tr>                                
                                <tr>
                                    <th></th>
                                    <td></td>
                                    <th>매출구분</th>
                                    <td>
                                        <select class="full" v-model="consultSearch.sale_tp_cd">
                                            <option :key="index" :value="item.cmm_dtl_cd" v-for="(item, index) in searchComboSailType">{{item.cmm_dtl_nm}}</option>
                                        </select>
                                    </td>
                                    <th>대금수금구분</th>
                                    <td>
                                        <select class="full" v-model="consultSearch.bill_ar_cd">
                                            <option :key="index" :value="item.cmm_dtl_cd" v-for="(item, index) in searchComboBillType">{{item.cmm_dtl_nm}}</option>
                                        </select>
                                    </td> 
                                    <th></th>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="page-box last">
                    <div class="pin-layout">
                        <div class="clear">
                            <div class="fl"><h3 class="content-title">표시컨설팅 목록</h3></div>                            
                            <div class="fr" v-if="userTpCd == 02 || userTpCd == 03 ">
                                <button class="btn-save" @click="onDownloadXls">엑셀다운로드</button>
                                <button class="btn-save" @click="openNewConsulRegPop" v-if="userTpCd == '03'">신규 컨설팅 등록</button>
                                <button class="btn-save" @click="openRequestRegPop" v-if="userTpCd == '03'">의뢰 컨설팅 등록</button>
                                <button class="btn-save" @click="openUptConsulRegPop">컨설팅 수정</button>
                                <button class="btn-save" @click="delConsult">컨설팅 삭제</button>
                            </div>                            
                        </div>
                        <div class="pin-layout-wrap">
                            <section class="tree-right-wrap">
                                <div class="tb-list">
                                    <div id="jqxGrid"></div>
                                </div>
                            </section>
                        </div>
                        <div class="pin-layout-wrap">
                            <section class="tree-right-wrap">
                                <div class="tb-list">
                                    <div id="jqxXls" style="border-color:#ffffff;">&nbsp;</div>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
            <!-- //content -->
		</div>

        <new-consult-pop
            v-if="openNewConsultPop" 
            :open="openNewConsultPop" 
            :cuslist="cusList"
            :managerlist="managerList" 
            :cescolist="cescoList" 
            :cusfoodtypelist="cusFoodTypeList" 
            :cusservicetypelist="cusServiceTypeList" 
            :cusunitpricetypelist="cusUnitpriceTypeList"
            :consultcominfo="consultComInfo"
            :cusbilltypelist="cusBillTypeList"
            :cussaletypelist="cusSaleTypeList" 
            :isreadonly="isReadonly"
            :ispartreadonly="isPartReadonly" 
            :salemnglist="saleMngList" 
            :contmnglist="contMngList" 
            @on-pop-close="closeNewConsulRegPop" 
            @on-manager-pop-open="openManagerSearch" 
            @on-cont-pop-open="openContSearch" 
            @on-favorites-pop-open="openCusFavoritesAdd"  
            @on-favorites-list-pop-open="openCusFavoritesList" 
            @on-set-cuscom-info="setCuscomInfo" 
            @set-cus-del="setCusDel" 
            @on-reload="drawGrid" 
            @set-main-manager-nm="setMainManagerNm"
            @set-main-cesco-nm="setMainCescoNm" 
            @set-manager-list="setManagerList" 
            @set-top-list="getSalesConEmployeeList"
        ></new-consult-pop>

        <manager-search-pop
            v-if="openManagerSearchPop" 
            :open="openManagerSearchPop" 
            :opentype="managerPopType" 
            @on-pop-close="closeManagerSearchPop" 
            @on-set-manager-info="setManagerInfo" 
            @on-set-cuscom-info="setCuscomInfo"
        ></manager-search-pop>

        <cont-search-pop
            v-if="openContSearchPop" 
            :open="openContSearchPop"             
            @on-pop-close="closeContSearchPop"
            @on-set-cont-info="setContInfo"
        ></cont-search-pop>

        <cst-mng-pop v-if="mngPop" 
            :mng-pop="mngPop" 
            :consultingmng="consultingMng" 
            @close-mng-pop="closeMngPop"
        ></cst-mng-pop>
        
</section>
</body>
</html>

<!-- 신규 컨설팅 등록 팝업 -->
<template id="newConsultPop">
    <div class="layer-pop-wrap" style="z-index:2000;" id="consultPopDiv">
        <div class="layer-pop-box xlarge">
            <div class="pop-wrap">
                <h1 class="blind">System > 표시컨설팅 > 신규 컨설팅 등록 팝업</h1>
                <header class="pop-header">
                    <div class="pop-header-title-wrap">
                        <h3 class="pop-header-title" v-if="isNew">신규 컨설팅 등록</h3>
                        <h3 class="pop-header-title" v-if="isUpt">컨설팅 수정</h3>
                        <h3 class="pop-header-title" v-if="isAddIns">의뢰 컨설팅 등록</h3>
                        <button class="btn-pop-close js-pop-close" @click="onPopClose">닫기</button>
                    </div>
                </header>
                <div class="pop-container">
                    <div class="pop-common-box">
                        <h3 class="content-title" v-if="isAddIns">컨설팅 의뢰정보</h3>
                        <div class="form-info-wrap">
                            <div class="form-info-box">
                                <dl v-if="isNew">
                                    <dt>고객사명</dt>
                                    <dd v-if="!isreadonly">{{consultcominfo.cst_nm}}<button class="btn-search mgl10" @click="onManagerSearchPopOpen('C')" ><i></i>조회</button></dd>
                                </dl>  
                                <dl v-if="!isNew">
                                    <dt>고객사명</dt>
                                    <dd>{{consultcominfo.cst_nm}}</dd>
                                </dl>
                                <dl>
                                    <dt>매출사원</dt>
                                    <dd>{{consultcominfo.sale_mng_nm}}<button class="btn-search mgl10" @click="onContSearchPopOpen('S')" v-if="!isreadonly" ><i></i>조회</button></dd>
                                </dl>
                                <dl>
                                    <dt>계약사원</dt>
                                    <dd>{{consultcominfo.cont_nm}}<button class="btn-search mgl10" @click="onContSearchPopOpen('C')" v-if="!isreadonly" ><i></i>조회</button></dd>
                                </dl>
                                <!-- <dl>
                                    <dt>매출사원</dt>                                    
                                    <dd>
                                        <select class="full" v-model="consultcominfo.sale_mng_id" id="selSalemnglist">
                                            <option value="">선택</option>
                                            <option :key="index" :value="item.user_num" v-for="(item, index) in salemnglist">[{{item.pos_nm}}]{{item.user_nm}}</option>
                                        </select>
                                    </dd>
                                </dl>
                                <dl>
                                    <dt>계약사원</dt>
                                    <dd>
                                        <select class="full" v-model="consultcominfo.cont_id" id="selContmnglist">
                                            <option value="">선택</option>
                                            <option :key="index" :value="item.user_num" v-for="(item, index) in contmnglist">[{{item.pos_nm}}]{{item.user_nm}}</option>
                                        </select>
                                    </dd>
                                </dl> -->
                                <dl>
                                    <dt>계산서 발행 여부</dt>
                                    <dd>
                                        <label class="radio mgr10" :key="index" v-for="(bill, index) in cusbilltypelist">
                                            <input type="radio" v-model="consultcominfo.tax_bill_tp_cd" :value="bill.cmm_dtl_cd" @click="setTaxBillCd(bill.cmm_dtl_cd)">
                                            <span class="ico"></span>
                                            <span class="txt">{{bill.cmm_dtl_nm}}</span>
                                        </label>
                                    </dd>
                                </dl>
                                <dl v-if="!isNew">
                                    <dt>업무담당자명</dt>
                                    <dd>{{consultcominfo.cst_mng_nm}}</dd>
                                </dl>
                                <dl v-if="!isNew">
                                    <dt>계산서담당자명</dt>
                                    <dd>{{consultcominfo.tax_bill_nm}}</dd>
                                </dl>
                                <dl v-if="!isNew">
                                    <dt>계산서 수신 이메일</dt>
                                    <dd>{{consultcominfo.tax_bill_email}}</dd>
                                </dl>
                            </div>
                        </div>
                        <div class="mgt30" v-if="isAddIns">
                            <div class="tb-list narrow">
                                <ul class="thead">
                                    <li>
                                        <div>제품명</div>
                                        <div style="width:25%;">유형</div>
                                        <div style="width:13%;">품목보고번호</div>
                                        <div style="width:25%;">제조업체명</div>
                                    </li>
                                </ul>
                                <ul class="tbody">
                                    <li :key="index" v-for="(prodTop, index) in consultProdListTop">
                                        <div>{{prodTop.prod_nm}}</div>
                                        <div style="width:25%;">{{prodTop.prod_tp_cust_nm}}</div>
                                        <div style="width:13%;">{{prodTop.prod_item}}</div>
                                        <div style="width:25%;">{{prodTop.prod_mafa_nm}}</div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="mgt10" v-if="isAddIns">
                            <table class="tb-view-01">
                                <colgroup><col width="30%"><col width=""></colgroup>
                                <tbody>
                                    <tr :key="index" v-for="(userFile, index) in userFileList">
                                        <th>{{userFile.atch_nm}}</th>
                                        <td><a href="javascript:void(0)" @click="onDownload(userFile.ser_file_nm)" class="a-link">{{userFile.url}}{{userFile.atch_nm}}</a></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="mgt30">
                            <h3 class="content-title tooltip">컨설팅 의뢰 제품정보
                                <span class="tooltip-title">?</span>
                                <span class="tooltip-content"><p>식품유형이 정해지지 않는 제품일 경우 자연상태식품으로 작성해주세요.</p></span>
                            </h3>
                            
                            <div class="tb-list tb-list_input narrow">
                                <ul class="thead">
                                    <li>
                                        <div>제품명<i class="th-star">*</i></div>                                        
                                        <div style="width:12%;">매출구분<i class="th-star">*</i></div>
                                        <div style="width:12%;">식품유형<i class="th-star">*</i></div>
                                        <div style="width:10%;">품목보고번호</div>
                                        <div style="width:10%;">서비스구분<i class="th-star">*</i></div>
                                        <div style="width:10%;">단가구분</div>
                                        <div style="width:10%;">제조업체명<i class="th-star">*</i></div>
                                        <div style="width:12%;">견적단가<i class="th-star">*</i></div>
                                        <div style="width:10%;"></div>
                                    </li>
                                </ul>

                                <ul class="tbody pdb0 pdt0">
                                    <li :key="index" v-for="(cons, index) in consultProdList">                                        
                                        <div><input type="text" v-model="cons.prod_nm" class="full" placeholder="제품명을 입력하세요" maxlength="30"></div>
                                        <div style="width:12%;">
                                            <select class="full" v-model="cons.sale_tp_cd">
                                                <option :key="index" :value="item.cmm_dtl_cd" v-for="(item, index) in cussaletypelist">{{item.cmm_dtl_nm}}</option>
                                            </select>
                                        </div>
                                        <div style="width:12%;">
                                            <div class="auto-search-wrap">
                                                <div class="auto-search-title">                                                    
                                                    <input type="text" v-model="cons.prod_tp_cust_nm" maxlength="50" class="full" placeholder="식품유형을 입력하세요" 
                                                    @input="onDeptKeyUp($event, index)" 
                                                    @click="onRegSelClick(index)" 
                                                    @keyup="onSelKeyUp($event, 'popSearchList', 'popChkLi', index)" 
                                                    autocomplete='off' 
                                                    name= "inputPopCom">
                                                </div>
                                                <div v-if="bSearchFtype[index]" class="auto-search-list" :id="'popSearchList'">
                                                    <div style="text-align:left;line-height:26px;">
                                                        <ul :id="'popChkLi'">
                                                            <li @click="selComInfo(item.cmm_dtl_cd, item.cmm_dtl_nm, index)" 
                                                             :key="idx" v-for="(item, idx) in popSearchComList" 
                                                             :value="item.cmm_dtl_cd" v-bind:data-tpcd="item.cmm_dtl_cd" 
                                                             style="padding-left:7px;">{{item.cmm_dtl_nm}}</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>                                            
                                        </div>
                                        <div style="width:10%;"><input type="text" v-model="cons.prod_item" class="full" placeholder="품목보고번호" maxlength="16"></div>
                                        <div style="width:10%;">
                                            <select class="full" v-model="cons.prod_ser_cd">
                                                <option :key="index" :value="item.cmm_dtl_cd" v-for="(item, index) in cusservicetypelist">{{item.cmm_dtl_nm}}</option>
                                            </select>
                                        </div>
                                        <div style="width:10%;">
                                            <select class="full" v-model="cons.prod_unit_cd" v-on:change="setAmtPrice(index)">
                                                <option :key="index" :value="item.cmm_dtl_cd" v-for="(item, index) in cusunitpricetypelist">{{item.cmm_dtl_nm}}</option>
                                            </select>
                                        </div>
                                        <div style="width:10%;"><input type="text" v-model="cons.prod_mafa_nm" class="full" placeholder="제조업체명을 입력하세요" maxlength="30"></div>
                                        <!-- <div style="width:12%;"><input type="number" v-model="cons.est_amt" class="full txt-r" placeholder="" @keyup="getSumAmt"></div> -->
                                        <div style="width:12%;"><input type="text" v-model="cons.est_amt" class="full txt-r" placeholder="" @input="chkMaxNum($event, index, 999999999)"></div>
                                        <div style="width:10%;" class="txt-l">
                                            <div class="tb-btns-wrap">
                                                <button class="btn-del" v-if="index > 0 && !isAddIns && !isreadonly" @click="delConcult(index)"><i>-</i><span>삭제</span></button>
                                                <button class="btn-add" v-if="index == consultProdList.length - 1 && !isAddIns && !isreadonly"  @click="addConcult"><i>+</i><span>추가</span></button>
                                            </div>
                                        </div>                                        
                                    </li>
                                    <li class="total">
                                        <div>
                                            <div>
                                                <!-- <div class="file-upload-wrap">
                                                    <div class="file-upload" :key="index" v-for="(estFile, index) in estimateFileList">
                                                        <input type="file" :id="'etc_file' + index" name="est_file" etc_file class="upload-hidden" @change="onFileUpload($event, index, 'S')">
                                                        <input v-model="estFile.org_file_nm" class="upload-name"  placeholder="견적서 파일을 선택하여 등록해주세요" disabled="disabled">
                                                        <label :for="'etc_file' + index" class="mgr3"><i></i>파일첨부</label>
                                                        <button @click="onDownload(estFile.ser_file_nm)" v-if="estFile.url != ''" class="btn-base">다운로드</button>                                                        
                                                    </div>
                                                </div> -->
                                            </div>
                                        </div>
                                        <div style="width:17%;" class="txt-r">견적 계</div>
                                        <div style="width:12%;" class="txt-r total-txt">{{sum_amt | currency}}</div>
                                        <div style="width:10%;" class="txt-l"></div>
                                    </li>
                                </ul>
                            </div>
                        </div> 

                        <div class="mgt30 clear">
                            <div class="column col20">
                                <div class="clear">
                                    <div class="fl"><h3 class="content-title">협력사</h3></div>
                                    <div class="fr mgt3">
                                        <button class="btn-round-blue js-pop-open" @click="onManagerSearchPopOpen('M')" v-if="(!isreadonly && !ispartreadonly) || (isreadonly && ispartreadonly)">협력사 추가</button>
                                        <!-- <button class="btn-round-blue" @click="onCusFavoritesListPopOpen">협력사 목록 가져오기</button> -->
                                    </div>
                                </div>                                
                                <div class="tb-list narrow">
                                    <ul class="thead">
                                        <li>
                                            <div style="width:50px;">No</div>
                                            <div><div class="flex-auto-end"><div>협력사</div>
                                            <!-- <div><button class="btn-round-blue fff" @click="onCusFavoritesAddPopOpen"><i class="ico-bookmark"></i>현재구성 즐겨찾기로 등록</button></div> -->
                                        </div>
                                        </li>
                                    </ul>
                                    <!-- 협력사 목록 -->
                                    <ul class="tbody" v-for="(cus, index) in cuslist">
                                        <li>
                                            <div style="width:50px;">{{index + 1}}</div>
                                            <div class="txt-l">{{cus.cst_nm}}</div>
                                            <div style="width:30px;"><button class="btn-del-single" @click="setCusDel(cus.cst_id)" v-if="consultcominfo.cst_id != cus.cst_id">삭제</button></div>
                                        </li>
                                    </ul>
                                </div>                                    
                            </div>
                            <div class="column col40 pdl20">
                                <h3 class="content-title">담당자</h3>
                                <div class="fr">
                                    <label>고객 주 담당자</label>
                                    <select id="selManager" class="grd-select" v-model="consultcominfo.cusMainManager" v-on:change="selCusMainManager($event, 1)">
                                        <option value="">선택</option>
                                        <option :key="index" :value="manager.user_id" v-for="(manager, index) in mngManagerList">{{manager.user_nm}}</option>
                                    </select>
                                </div>
                                <div class="tb-list narrow">
                                    <ul class="thead">
                                        <li>
                                            <div style="width:8%;">No</div>
                                            <div style="width:8%;">선택</div>
                                            <div style="width:8%;">정산</div>
                                            <div>업체명</div>
                                            <div style="width:15%;" class="txt-l">담당자</div>
                                            <div style="width:30%;">이메일</div>
                                        </li>
                                    </ul>
                                    <ul class="tbody" :key="index" v-for="(manager, index) in managerlist">
                                        <li>
                                            <div style="width:8%;">{{index + 1}}</div>
                                            <div style="width:8%;">
                                                <label class="check">
                                                    <input type="checkbox" v-model="manager.fs_chat_yn" true-value="Y" false-value="N" v-on:change="onChkManager">
                                                    <span class="ico"></span>
                                                </label>
                                            </div>
                                            <div style="width:8%;">                                                
                                                <label class="check">
                                                    <input type="checkbox" :disabled="ispartreadonly || consultcominfo.tax_bill_tp_cd == '02'" v-model="manager.fs_bill_mng_yn" name="bill_check" true-value="Y" false-value="N" v-on:change="onChkBillManager(index)">                                                    
                                                    <span class="ico"></span>
                                                </label>
                                            </div>
                                            <div class="txt-l">{{manager.cst_nm}}</div>
                                            <div style="width:15%;" class="txt-l">{{manager.user_nm}}</div>
                                            <div style="width:30%;">{{manager.email}}</div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="column col40 pdl20">
                                <div>
                                    <h3 class="content-title">세스코 담당자</h3>
                                    <div class="fr">
                                        <label>세스코 주 담당자</label>
                                        <select id="selCescoManager" class="grd-select" v-model="consultcominfo.cescoMainManager" v-on:change="selCusMainManager($event, 2)">
                                            <option value="">선택</option>
                                            <option :key="index" :value="cesco.user_id" v-for="(cesco, index) in mngCescoList">{{cesco.user_nm}}</option>
                                        </select>
                                    </div><div class="tb-list narrow">
                                        <!-- <div id="cescoGrid"></div> -->
                                        <ul class="thead">
                                            <li>
                                                <div style="width:8%;">No</div>
                                                <div style="width:8%;">선택</div>
                                                <div>부서명</div>
                                                <div style="width:15%;" class="txt-l">담당자</div>
                                                <div style="width:30%;">이메일</div>
                                            </li>
                                        </ul>
                                        <ul class="tbody" :key="index" v-for="(cesco, index) in cescolist">
                                            <li>
                                                <div style="width:8%;">{{index + 1}}</div>
                                                <div style="width:8%;">
                                                    <label class="check">
                                                        <input type="checkbox" v-model="cesco.fs_chat_yn" true-value="Y" false-value="N" v-on:change="onChkCesco">
                                                        <span class="ico"></span>
                                                    </label>
                                                </div>
                                                <div class="txt-l"> {{cesco.user_dept_nm}}</div>
                                                <div style="width:15%;" class="txt-l">{{cesco.user_nm}}</div>
                                                <div style="width:30%;">{{cesco.email}}</div>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mgt30 clear">
                            <div class="column col2eq-last">
                                <h3 class="content-title">첨부파일</h3>
                                <table class="tb-view-01 narrow">
                                    <colgroup><col width="20%"><col width=""><col width="83px"></colgroup>
                                    <tbody> 
                                        <tr :key="fileIndex" v-for="(attachfile, fileIndex) in attachFileList">
                                            <th align="left">
                                                <select class="grd-select" v-model="attachfile.atch_ref_id">
                                                    <option value="">선택</option>
                                                    <option :key="index" :value="item.prod_tp_cd" v-for="(item, index) in attachFileTypeList">{{item.prod_tp_cust_nm}}</option>
                                                </select>
                                                <!-- <input type="text" class="" placeholder="파일명" v-model="attachfile.atch_nm"> -->
                                            </th>
                                            <td>
                                                <div class="file-upload-wrap">
                                                    <div class="file-upload">
                                                        <button class="btn-base" style="margin-right:5px;" @click="onDownload(attachfile.ser_file_nm)" v-if="attachfile.url != ''">다운로드</button>
                                                        <input type="file" :id="'attach_file' + fileIndex" name="attach_file_list" class="upload-hidden" @change="onFileUpload($event, fileIndex, 'M')">
                                                        <input class="upload-name" v-model="attachfile.org_file_nm" placeholder="파일을 선택해 주세요." disabled="disabled">
                                                        <label :for="'attach_file' + fileIndex" v-if="!isreadonly"><i></i>파일첨부</label>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="txt-l">
                                                <div class="tb-btns-wrap">
                                                    <button class="btn-del" v-if="!isreadonly" @click="delFileUpload(fileIndex)"><i>-</i><span>삭제</span></button>
                                                    <button class="btn-add" v-if="fileIndex === attachFileList.length - 1 && !isreadonly" @click="addFileUpload('attachFileList')" ><i>+</i><span>추가</span></button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="pop-bottom">
                    <div class="pop-btn-box">
                        <a href="javascript:void(0);" class="btn-pop-bottom" @click="onPopClose">취소</a>
                        <a href="javascript:void(0);" class="btn-pop-bottom" @click="setConSult" v-if="!isUpt" >등록</a>                        
                        <a href="javascript:void(0);" class="btn-pop-bottom" @click="setConSult" v-if="isUpt && !ispartreadonly" >수정</a>
                        <a href="javascript:void(0);" class="btn-pop-bottom" @click="setConSultManager" v-if="isUpt && ispartreadonly" >수정</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<!-- 협렵사 담당자 선택 팝업 -->
<template id="managerSearchPop">
    <div class="layer-pop-wrap" style="z-index: 3000;">
        <div class="layer-pop-box midium">
            <div class="pop-wrap">
                <h1 class="blind">고객사 검색</h1>
                <header class="pop-header">
                    <div class="pop-header-title-wrap">
                        <h3 class="pop-header-title">협력사 검색</h3>
                        <button class="btn-pop-close js-pop-close" @click="onPopClose">닫기</button>
                    </div>
                </header>
                <div class="pop-container">
                    <div class="pop-common-box">
                        <div class="pop-search-form">
                            <label>고객사명</label>
                            <input type="text" v-model="srchCstNm" @keyup.enter="searchManager">
                            <button class="btn-search" @click="searchManager"><i></i>조회</button>
                        </div>
                        <div class="tb-list mgt20">
                            <div id="customerGrid">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="pop-bottom">
                    <div class="pop-btn-box">
                        <a href="javascript:void(0);" class="btn-pop-bottom js-pop-close" @click="onPopClose">취소</a>
                        <a href="javascript:void(0);" class="btn-pop-bottom" @click="setManager">등록</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<!-- 계약자 조회 팝업 -->
<template id="contSearchPop">
    <div class="layer-pop-wrap" style="z-index: 3000;">
        <div class="layer-pop-box midium">
            <div class="pop-wrap">
                <h1 class="blind">계약지 검색</h1>
                <header class="pop-header">
                    <div class="pop-header-title-wrap">
                        <h3 class="pop-header-title">계약자 검색</h3>
                        <button class="btn-pop-close js-pop-close" @click="onPopClose">닫기</button>
                    </div>
                </header>
                <div class="pop-container">
                    <div class="pop-common-box">
                        <div class="pop-search-form">
                            <label>계약자명</label>
                            <input type="text" v-model="searchNm" @keyup.enter="drawTable">
                            <button class="btn-search" @click="drawTable"><i></i>조회</button>
                        </div>
                        <div class="tb-list mgt20">
                            <div id="contGrid"></div>
                        </div>
                    </div>
                </div>
                <div class="pop-bottom">
                    <div class="pop-btn-box">
                        <a href="javascript:void(0);" class="btn-pop-bottom js-pop-close" @click="onPopClose">취소</a>
                        <a href="javascript:void(0);" class="btn-pop-bottom" @click="setCont">등록</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<!-- 담당자 팝업--> 
<template id="cstMngPop">	
    <div class="layer-pop-wrap">
        <div class="layer-pop-box midium">
            <div class="pop-wrap">
                <h1 class="blind">담당자 조회</h1>
                <header class="pop-header">
                    <div class="pop-header-title-wrap">
                        <h3 class="pop-header-title">담당자</h3>
                        <button class="btn-pop-close js-pop-close" @click="cloasePop">닫기</button>
                    </div>
                </header>
                <div class="pop-container">
                    <div class="pop-common-box">
                        <table class="tb-view-01">
                            <colgroup><col width="30%"><col width=""></colgroup>
                            <tbody>
                                <tr>
                                    <th>담당자명</th>                                  
                                    <td><input type="text" class="full" v-model="consultingmng.user_nm" disabled></td>
                                </tr>
                                <tr>
                                    <th>연락처</th>
                                    <td><input type="text" class="full" v-model="consultingmng.mphone_no" disabled></td>
                                </tr>
                                <tr>
                                    <th>아이디</th>
                                    <td><input type="text" class="full" v-model="consultingmng.user_id" disabled></td>
                                </tr>
                                <tr>
                                    <th>이메일</th>
                                    <td><input type="text" class="full" v-model="consultingmng.email" disabled></td>
                                </tr>
                                <tr>
                                    <th>고객사</th>
                                    <td><input type="text" class="full" v-model="consultingmng.cst_nm" disabled></td>
                                </tr>                          
                                <tr>
                                    <th>진행중인 컨설팅 수</th>
                                    <td><input type="text" class="full" v-model="consultingmng.consult_cnt" disabled></td>
                                </tr>
                                <tr>
                                    <th>등록일시</th>
                                    <td><input type="text" class="full" v-model="consultingmng.rgstr_dt" disabled></td>
                                </tr>
                                <tr>
                                    <th>최근 로그인 일시</th>
                                    <td><input type="text" class="full" v-model="consultingmng.last_dt" disabled></td>
                                </tr>                            
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>