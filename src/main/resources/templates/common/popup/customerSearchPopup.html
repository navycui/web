<script th:inline="javascript" type="text/javascript">
    var custSrchPopVue
    $(document).ready(function(){
        custSrchPopVue = new Vue({
            el: '#customerSearchPopup',
            data: {
                srchCstNm: [[${cstNm}]],
                checkboxYn : [[${checkboxYn}]],
                customerList:[],
            },
            methods: {
                // 조회
                getCustomerList: function() {
                    let url = '/commPopup/getCustomerListForPop';
                    let _this = this;
                    let msg = '';
                    let param = {srchCstNm:(_this.srchCstNm == null || _this.srchCstNm == undefined ? '' : _this.srchCstNm)};

                    axiosCall('get', url, param, function(res){
                        _this.customerList = res.data;
                        _this.drawTable();
                    }, msg);
                },
                drawTable: function() {
                    let _this = this;
                    var selectionmode = _this.checkboxYn == 'Y' ? 'checkbox' : 'singlerow';

                    var source = {  
                        datatype: "json", // json 형태의 데이터를 셋팅할 것이고. // array
                        datafields: [     // 각필의 이름과 타입은 datafields에 마찬가지로 json 형태이다.
                            { name: 'sys_id', type: 'string' },     // sys id
                            { name: 'cst_nm', type: 'string' },     // 고객사명
                            { name: 'cst_id', type: 'string' },     // 고객사 코드
                            { name: 'mdfr_dt', type: 'string' },    // 수정일시(등록일시)
                        ],  
                        localdata: _this.customerList, // 위에서 셋팅해놓은 data를 localdata에 담아준다.
                    };
                    
                    var dataAdapter = new $.jqx.dataAdapter(source);  
                    
                    $("#customerGrid").jqxGrid({  
                        width: '100%',
                        height: '205',
                        source: dataAdapter,        //위에서 만든 dataAdapter
                        sortable: true,
                        filterable: true,
                        columnsresize: true,        //column의 너비를 컨텐츠에 맞게 리사이징
                        selectionmode: selectionmode,  // singlerow
                        showrowlines: false,
                        showcolumnlines: false,
                        localization: { emptydatastring:'해당 자료가 존재하지 않습니다.' },
                        columns: [                  // 각 컬럼값들의 대한 설정이다.
                            {
                                text: 'No', sortable: false, filterable: false, editable: false,
                                groupable: false, draggable: false, resizable: false,
                                datafield: '', columntype: 'number', align:'center',
                                cellsrenderer: function (row, column, value) {
                                    return "<div style='text-align: center; margin-top: 8px;'>" + (value + 1) + "</div>";
                                }
                            },
                            { text: '고객사명', datafield: 'cst_nm', align:'center' },  
                            { text: '고객사코드', datafield: 'cst_id', align:'center', cellsalign:'center' },  
                            { text: '등록일시', datafield: 'mdfr_dt', width: 120, align:'center', cellsalign:'center' },
                        ]  
                    });

                    // 더블클릭시 클릭한 데이터만 넘어감.
                    $('#customerGrid').on("celldoubleclick", function(event) {
                        var args = event.args;
                        var rowBoundIndex = args.rowindex;
                        var rowBoundData = args.row.bounddata;

                        vue.param1 = rowBoundData.cst_nm;
                        vue.customerSearchPopupData = [rowBoundData];
                        vue.setPopupData([rowBoundData]);

                        closeCmmPopup('customerSearchPopup');
                    });

                },
                // 팝업 닫기 & 데이터 넘기기
                closePopup: function(val) {
                    let _this = this;
                    
                    if(val == '1'){
                        // 체크된 데이터
                        let checkedData = [];
                        let selectedRowIndexes = $("#customerGrid").jqxGrid('getselectedrowindexes');
                        let pageInfo = $("#customerGrid").jqxGrid('getpaginginformation')
                        let preLastIdx = (pageInfo.pagenum * pageInfo.pagesize) - 1;
                        let curLastIdx = ((pageInfo.pagenum + 1) * pageInfo.pagesize) -1;

                        // 선택 확인.
                        if(selectedRowIndexes.length > 0) {
                            $.each(selectedRowIndexes, function(i, v) {
                                if(v > preLastIdx && v <= curLastIdx) {
                                    checkedData.push($('#customerGrid').jqxGrid('getrowdata', v))
                                }
                            })
                            vue.customerSearchPopupData = checkedData;
                            vue.setPopupData(checkedData);
                        } else {
                            cmmAlert("체크박스가 선택되지 않았습니다.")
                            return false;
                        }

                    } else {
                        // vue.customerSearchPopupData = [];
                    }
                    closeCmmPopup('customerSearchPopup');
                }
            },
            mounted() {
                this.getCustomerList();
            },
        })
    });
</script>
<section layout:fragment="content" id="customerSearchPopup" v-cloak>
    <div class="layer-pop-wrap" >
        <div class="layer-pop-box midium">
            <div class="pop-wrap">
                <h1 class="blind">고객사 검색</h1>
                <header class="pop-header">
                    <div class="pop-header-title-wrap">
                        <h3 class="pop-header-title">고객사 검색</h3>
                        <button class="btn-pop-close js-pop-close" @click="closePopup('0')">닫기</button>
                    </div>
                </header>
                <div class="pop-container">
                    <div class="pop-common-box">
                        <div class="pop-search-form">
                            <label>고객사명</label>
                            <input type="text" v-model="srchCstNm">
                            <button class="btn-search" @click="getCustomerList"><i></i>조회</button>
                        </div>
                        <div class="tb-list mgt20">
                            <div id="customerGrid">
                            </div>
                        </div>
                        <!-- <div class="tb-list mgt20">
                            <ul class="thead">
                                <li>
                                    <div style="width:14%;">No</div>
                                    <div>고객사명</div>
                                    <div style="width:25%;">고객사코드</div>
                                    <div style="width:25%;">등록일시</div>
                                </li>
                            </ul>
                            <ul class="tbody">
                                <li>
                                    <div style="width:14%;">
                                        <label class="check">
                                            <input type="checkbox">
                                            <span class="ico"></span>
                                            <span class="txt">1</span>
                                        </label>
                                    </div>
                                    <div class="txt-l">CJ</div>
                                    <div style="width:25%;">C00001</div>
                                    <div style="width:25%;">2022.01.01 12:00:00</div>
                                </li>
                                <li>
                                    <div style="width:14%;">
                                        <label class="check">
                                            <input type="checkbox">
                                            <span class="ico"></span>
                                            <span class="txt">2</span>
                                        </label>
                                    </div>
                                    <div class="txt-l">롯데쇼핑</div>
                                    <div style="width:25%;">C00002</div>
                                    <div style="width:25%;">2022.01.01 12:00:00</div>
                                </li>
                            </ul>
                        </div> -->
                    </div>
                </div>
                <div class="pop-bottom">
                    <div class="pop-btn-box">
                        <a href="#" class="btn-pop-bottom js-pop-close" @click="closePopup('0')">취소</a>
                        <a href="#" class="btn-pop-bottom" @click="closePopup('1')">등록</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>