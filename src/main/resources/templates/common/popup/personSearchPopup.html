<!-- // 담당자 검색 팝업 -->
<script th:inline="javascript" type="text/javascript">
    var userSrchPopVue
    $(document).ready(function(){
        userSrchPopVue = new Vue({
            el: '#personSearchPopup',
            data: {
                srchCstNm: [[${cstNm}]],
                srchUserNm: [[${userNm}]],
                checkboxYn : [[${checkboxYn}]],
                custList:[],
            },
            methods: {
                // 조회
                getUserList: function() {
                    let url = '/commPopup/getUserListForPop';
                    let _this = this;
                    let msg = '';
                    let srchUserNm = _this.srchUserNm == null || _this.srchUserNm == undefined ? '' : _this.srchUserNm;
                    let srchCstNm = _this.srchCstNm == null || _this.srchCstNm == undefined ? '' : _this.srchCstNm;
                    let param = {srchUserNm: srchUserNm, 
                                srchCstNm: srchCstNm
                            };

                    axiosCall('get', url, param, function(res){
                        _this.custList = res.data;
                        _this.drawTable();
                    }, msg);
                },
                drawTable: function() {
                    let _this = this;
                    var selectionmode = _this.checkboxYn == 'Y' ? 'checkbox' : 'singlerow';

                    var source = {  
                        datatype: "json", // json 형태의 데이터를 셋팅할 것이고. // array
                        datafields: [     // 각필의 이름과 타입은 datafields에 마찬가지로 json 형태이다.
                            { name: 'user_id', type: 'string' },    // user id
                            { name: 'user_nm', type: 'string' },    // user name
                            { name: 'cst_nm', type: 'string' },     // 회사명
                            { name: 'cst_id', type: 'string' },     // 계정코드
                            { name: 'mdfr_dt', type: 'string' },    // 등록일시

                        ],  
                        localdata: _this.custList, // 위에서 셋팅해놓은 data를 localdata에 담아준다.
                        pagenum: 0,
                        pagesize: 5,
                        pager: function (pagenum, pagesize, oldpagenum) {
                            // callback called when a page or page size is changed.
                        }
                    };
                    
                    var dataAdapter = new $.jqx.dataAdapter(source);  

                    $("#userGrid").jqxGrid({  
                        width: '100%',
                        height: '350',
                        source: dataAdapter, //위에서 만든 dataAdapter
                        sortable: true,
                        filterable: true,
                        columnsresize: true,        //column의 너비를 컨텐츠에 맞게 리사이징
                        pageable: true,
                        pagermode: 'simple',
                        selectionmode: selectionmode,
                        showrowlines: false,
                        showcolumnlines: false,
                        localization: { emptydatastring:'해당 자료가 존재하지 않습니다.' },
                        columns: [                  // 각 컬럼값들의 대한 설정이다.
                            {
                                text: 'No', sortable: false, filterable: false, editable: false,
                                groupable: false, draggable: false, resizable: false,
                                datafield: '', columntype: 'number', align:'center',
                                cellsrenderer: function (row, column, value) {
                                    return "<div style='text-align: center; margin-top: 8px;'>" + (value + 1) + "</div>";
                                }
                            },
                            { text: '사업장명', datafield: 'cst_nm', align:'center' },  
                            { text: '고객명', datafield: 'user_nm', align:'center', cellsalign:'center' },  
                            { text: '아이디', datafield: 'user_id', width: 120, align:'center', cellsalign:'center' },  
                            { text: '계정코드', datafield: 'cst_id', width: 120, align:'center', cellsalign:'center' },  
                            { text: '등록일시', datafield: 'mdfr_dt', width: 120, align:'center', cellsalign:'center' },
                        ]  
                    });

                    // 더블클릭시 클릭한 데이터만 넘어감.
                    $('#userGrid').on("celldoubleclick", function(event) {
                        var args = event.args;
                        var rowBoundIndex = args.rowindex;
                        var rowBoundData = args.row.bounddata;

                        vue.param1 = rowBoundData.cst_nm;
                        vue.personSearchPopupData = [rowBoundData];
                        vue.setPopupData([rowBoundData]);

                        closeCmmPopup('personSearchPopup');
                    });

                },
                // 팝업 닫기 & 데이터 넘기기
                closePopup: function(val) {
                    let _this = this;

                    if(val == '1'){
                        // 체크된 데이터
                        let checkedData = [];
                        let selectedRowIndexes = $("#userGrid").jqxGrid('getselectedrowindexes');
                        let pageInfo = $("#userGrid").jqxGrid('getpaginginformation')
                        let preLastIdx = (pageInfo.pagenum * pageInfo.pagesize) - 1;
                        let curLastIdx = ((pageInfo.pagenum + 1) * pageInfo.pagesize) -1;

                        // 선택 확인.
                        if(selectedRowIndexes.length > 0) {
                            $.each(selectedRowIndexes, function(i, v) {
                                if(v > preLastIdx && v <= curLastIdx) {
                                    checkedData.push($('#userGrid').jqxGrid('getrowdata', v))
                                }
                            })
                            vue.personSearchPopupData = checkedData;
                            vue.setPopupData(checkedData);
                        } else {
                            cmmAlert("체크박스가 선택되지 않았습니다.")
                            return false;
                        }

                    } else {
                        // vue.personSearchPopupData = [];
                    }

                    closeCmmPopup('personSearchPopup');
                }
            },
            mounted() {
                this.getUserList();
            },
        })
    });
</script>
<section layout:fragment="content" id="personSearchPopup" v-cloak>
    <div class="layer-pop-wrap">
        <div class="layer-pop-box large">
            <div class="pop-wrap">
                <h1 class="blind">담당자 검색</h1>
                <header class="pop-header">
                    <div class="pop-header-title-wrap">
                        <h3 class="pop-header-title">담당자 검색</h3>
                        <button class="btn-pop-close js-pop-close" @click="closePopup('0')">닫기</button>
                    </div>
                </header>
                <div class="pop-container">
                    <div class="pop-common-box">
                        <div class="txt-r mgb10">
                            <button class="btn-search" @click="getUserList"><i></i>조회</button>
                        </div>
                        <div class="board-search bg">
                            <table>
                                <colgroup>
                                    <col width="80px"><col width="25%"><col width="80px"><col width=""><col width="80px"><col width="">
                                </colgroup>
                                <tbody>
                                    <tr>
                                        <th>고객사명</th>
                                        <td><input type="text" class="full" placeholder="" v-model="srchCstNm"></td>
                                        <!-- <th>협력사명</th>
                                        <td><input type="text" class="full" placeholder="" v-model="srchPartnerNm"></td> -->
                                        <th>고객명</th>
                                        <td><input type="text" class="full" placeholder="" v-model="srchUserNm"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="mgt30">
                            <h3 class="content-title">고객사계정</h3>
                            <div id="userGrid">
                            </div>
                            <!-- <div class="tb-list">
                                <ul class="thead">
                                    <li>
                                        <div style="width:10%;">No</div>
                                        <div>사업장명</div>
                                        <div style="width:15%;">고객명</div>
                                        <div style="width:15%;">아이디</div>
                                        <div style="width:15%;">계정코드</div>
                                        <div style="width:18%;">등록일시</div>
                                    </li>
                                </ul>
                                <ul class="tbody">
                                    <li>
                                        <div style="width:10%;">
                                            <label class="check">
                                                <input type="checkbox">
                                                <span class="ico"></span>
                                                <span class="txt">1</span>
                                            </label>
                                        </div>
                                        <div class="txt-l">CJ진천공장</div>
                                        <div style="width:15%;">김고객</div>
                                        <div style="width:15%;">cj001</div>
                                        <div style="width:15%;">C00001</div>
                                        <div style="width:18%;">2022.01.01 12:00:00</div>
                                    </li>
                                    <li>
                                        <div style="width:10%;">
                                            <label class="check">
                                                <input type="checkbox">
                                                <span class="ico"></span>
                                                <span class="txt">2</span>
                                            </label>
                                        </div>
                                        <div class="txt-l">롯데쇼핑</div>
                                        <div style="width:15%;">최고객</div>
                                        <div style="width:15%;">lt0001</div>
                                        <div style="width:15%;">C00003</div>
                                        <div style="width:18%;">2022.01.01 12:00:00</div>
                                    </li>
                                </ul>
                            </div>
                            <hr>
                            <div class="clear mgt10">
                                <div class="fr">
                                    <div class="paging-wrap">
                                        <div class="paging">
                                            <a class="first" title="이전 끝으로 이동" href="#">이전 끝으로 이동</a>
                                            <a class="prev" title="이전 10 페이지 전으로 이동" href="#">이전 10 페이지 전으로 이동</a>
                                            <a class="page-on" href="#">1</a>
                                            <a href="#">2</a>
                                            <a href="#">3</a>
                                            <a href="#">4</a>
                                            <a href="#">5</a>
                                            <a class="next" title="다음 10 페이지 후로 이동" href="#">다음 10 페이지 후로 이동</a>
                                            <a class="last" title="다음 끝으로 이동" href="#">다음 끝으로 이동</a>
                                        </div>
                                        <select class="paging-select"><option>10개씩 보기</option></select>
                                    </div>
                                </div>
                            </div> -->
                        </div>
                    </div>
                </div>
                <div class="pop-bottom">
                    <div class="pop-btn-box">
                        <a href="#" class="btn-pop-bottom js-pop-close" @click="closePopup('0')">취소</a>
                        <a href="#" class="btn-pop-bottom" @click="closePopup('1')">등록</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
